<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#ddd">
<meta name="generator" content="Hexo 6.0.0">

<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#ddd">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-X7rrn44l1+AUO65h1LGALBbOc5C5bOstSYsNlv9MhT8=" crossorigin="anonymous">
  <link rel="stylesheet" href="/lib/@fancyapps/fancybox/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.imssyang.com","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.9.0","exturl":false,"sidebar":{"position":"right","width":300,"display":"hide","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"rgba(255, 255, 255, 0.1)","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":{"disqus":{"text":"Disqus","order":-1},"gitalk":{"text":"Github","order":-2}}},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":3,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>
<meta name="description" content="Go 基础语法梳理。">
<meta property="og:type" content="article">
<meta property="og:title" content="Go语言基础">
<meta property="og:url" content="https://blog.imssyang.com/ProgrammingLanguage/Go/Basic.html">
<meta property="og:site_name" content="Just Do It">
<meta property="og:description" content="Go 基础语法梳理。">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-04-15T05:49:22.000Z">
<meta property="article:modified_time" content="2023-04-15T12:08:30.000Z">
<meta property="article:author" content="Ssyang">
<meta property="article:tag" content="Go">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.imssyang.com/ProgrammingLanguage/Go/Basic.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://blog.imssyang.com/ProgrammingLanguage/Go/Basic.html","path":"ProgrammingLanguage/Go/Basic.html","title":"Go语言基础"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Go语言基础 | Just Do It</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Just Do It</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">by Ssyang</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%89%B9%E7%82%B9"><span class="nav-number">1.</span> <span class="nav-text">特点</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="nav-number">1.1.</span> <span class="nav-text">垃圾回收</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%A3%8E%E6%A0%BC%EF%BC%88idiom%EF%BC%89"><span class="nav-number">2.</span> <span class="nav-text">风格（idiom）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%EF%BC%88data%EF%BC%89"><span class="nav-number">3.</span> <span class="nav-text">数据（data）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#const"><span class="nav-number">3.1.</span> <span class="nav-text">const</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#variable"><span class="nav-number">3.2.</span> <span class="nav-text">variable</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%9C%E7%94%A8%E5%9F%9F%EF%BC%88scope%EF%BC%89"><span class="nav-number">4.</span> <span class="nav-text">作用域（scope）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%EF%BC%88type%EF%BC%89"><span class="nav-number">5.</span> <span class="nav-text">类型（type）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A7%8D%E7%B1%BB"><span class="nav-number">5.1.</span> <span class="nav-text">种类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Boolean"><span class="nav-number">5.1.1.</span> <span class="nav-text">Boolean</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Numeric"><span class="nav-number">5.1.2.</span> <span class="nav-text">Numeric</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#integer"><span class="nav-number">5.1.2.1.</span> <span class="nav-text">integer</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%BA%A2%E5%87%BA%EF%BC%88overflow%EF%BC%89"><span class="nav-number">5.1.2.1.1.</span> <span class="nav-text">溢出（overflow）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#float"><span class="nav-number">5.1.2.2.</span> <span class="nav-text">float</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#imaginary"><span class="nav-number">5.1.2.3.</span> <span class="nav-text">imaginary</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#rune"><span class="nav-number">5.1.2.4.</span> <span class="nav-text">rune</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#String"><span class="nav-number">5.1.3.</span> <span class="nav-text">String</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Array"><span class="nav-number">5.1.4.</span> <span class="nav-text">Array</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Slice"><span class="nav-number">5.1.5.</span> <span class="nav-text">Slice</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%87%E7%89%87%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%88slice-expression%EF%BC%89"><span class="nav-number">5.1.5.1.</span> <span class="nav-text">切片表达式（slice expression）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Map"><span class="nav-number">5.1.6.</span> <span class="nav-text">Map</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Set"><span class="nav-number">5.1.6.1.</span> <span class="nav-text">Set</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Struct"><span class="nav-number">5.1.7.</span> <span class="nav-text">Struct</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Align"><span class="nav-number">5.1.7.1.</span> <span class="nav-text">Align</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pointer"><span class="nav-number">5.1.8.</span> <span class="nav-text">Pointer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Function"><span class="nav-number">5.1.9.</span> <span class="nav-text">Function</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8D%E5%AE%9A%E9%95%BF%E5%8F%82%E6%95%B0%EF%BC%88variadic%EF%BC%89"><span class="nav-number">5.1.9.1.</span> <span class="nav-text">不定长参数（variadic）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BB%B6%E8%BF%9F%E8%B0%83%E7%94%A8%EF%BC%88defer%EF%BC%89"><span class="nav-number">5.1.9.2.</span> <span class="nav-text">延迟调用（defer）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Interface"><span class="nav-number">5.1.10.</span> <span class="nav-text">Interface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Channel"><span class="nav-number">5.1.11.</span> <span class="nav-text">Channel</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B3%E9%97%AD%E9%80%9A%E9%81%93"><span class="nav-number">5.1.11.1.</span> <span class="nav-text">关闭通道</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A9%E5%B1%95"><span class="nav-number">5.2.</span> <span class="nav-text">扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E5%A3%B0%E6%98%8E%EF%BC%88method-declaration%EF%BC%89"><span class="nav-number">5.2.1.</span> <span class="nav-text">方法声明（method declaration）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E6%96%AD%E8%A8%80%EF%BC%88type-assertion%EF%BC%89"><span class="nav-number">5.2.2.</span> <span class="nav-text">类型断言（type assertion）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%86%85%E5%BB%BA%E5%87%BD%E6%95%B0%EF%BC%88built-in-function%EF%BC%89"><span class="nav-number">6.</span> <span class="nav-text">内建函数（built-in function）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#panic-amp-recover"><span class="nav-number">6.1.</span> <span class="nav-text">panic &amp; recover</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E7%BB%93%E6%9E%84%EF%BC%88control-structure%EF%BC%89"><span class="nav-number">7.</span> <span class="nav-text">控制结构（control structure）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#if"><span class="nav-number">7.1.</span> <span class="nav-text">if</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#switch"><span class="nav-number">7.2.</span> <span class="nav-text">switch</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#for"><span class="nav-number">7.3.</span> <span class="nav-text">for</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#range"><span class="nav-number">7.3.1.</span> <span class="nav-text">range</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#select"><span class="nav-number">7.4.</span> <span class="nav-text">select</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#break"><span class="nav-number">7.5.</span> <span class="nav-text">break</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#continue"><span class="nav-number">7.6.</span> <span class="nav-text">continue</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#goto"><span class="nav-number">7.7.</span> <span class="nav-text">goto</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#go"><span class="nav-number">7.8.</span> <span class="nav-text">go</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#goroutine"><span class="nav-number">7.8.1.</span> <span class="nav-text">goroutine</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B6%85%E6%97%B6"><span class="nav-number">7.8.1.1.</span> <span class="nav-text">超时</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%80%E5%87%BA"><span class="nav-number">7.8.1.2.</span> <span class="nav-text">退出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B9%B6%E8%A1%8C%E6%80%A7%EF%BC%88Parallelization%EF%BC%89"><span class="nav-number">7.8.1.3.</span> <span class="nav-text">并行性（Parallelization）</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B%EF%BC%88generic-programming%EF%BC%89"><span class="nav-number">8.</span> <span class="nav-text">泛型编程（generic programming）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E5%8F%82%E6%95%B0%EF%BC%88Type-parameter%EF%BC%89"><span class="nav-number">8.1.</span> <span class="nav-text">类型参数（Type parameter）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E7%BA%A6%E6%9D%9F%EF%BC%88Type-constraint%EF%BC%89"><span class="nav-number">8.2.</span> <span class="nav-text">类型约束（Type constraint）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8C%85%EF%BC%88package%EF%BC%89"><span class="nav-number">9.</span> <span class="nav-text">包（package）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%EF%BC%88module%EF%BC%89"><span class="nav-number">10.</span> <span class="nav-text">模块（module）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4%EF%BC%88workspace%EF%BC%89"><span class="nav-number">11.</span> <span class="nav-text">工作空间（workspace）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">12.</span> <span class="nav-text">参考</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ssyang"
      src="/images/imssyang/windmill.png">
  <p class="site-author-name" itemprop="name">Ssyang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">34</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">34</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/imssyang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;imssyang" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:imssyang@gmail.com" title="E-Mail → mailto:imssyang@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/lib/@creativecommons/vocabulary/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.dabeaz.com/" title="https:&#x2F;&#x2F;www.dabeaz.com" rel="noopener" target="_blank">David Beazley</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://coldattic.info/" title="http:&#x2F;&#x2F;coldattic.info" rel="noopener" target="_blank">A Foo Walks into a Bar...</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.brendangregg.com/" title="https:&#x2F;&#x2F;www.brendangregg.com" rel="noopener" target="_blank">Brendan Gregg's Homepage</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.wowza.com/blog" title="https:&#x2F;&#x2F;www.wowza.com&#x2F;blog" rel="noopener" target="_blank">WOWZA Media Systems</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://preshing.com/" title="https:&#x2F;&#x2F;preshing.com" rel="noopener" target="_blank">Preshing on Programming</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.yinwang.org/" title="https:&#x2F;&#x2F;www.yinwang.org" rel="noopener" target="_blank">当然我在扯淡</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.jianchihu.net/" title="https:&#x2F;&#x2F;blog.jianchihu.net" rel="noopener" target="_blank">剑痴乎</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://betterexplained.com/" title="https:&#x2F;&#x2F;betterexplained.com" rel="noopener" target="_blank">Better Explained</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.mathsisfun.com/" title="https:&#x2F;&#x2F;www.mathsisfun.com" rel="noopener" target="_blank">Math is Fun</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://notes.shichao.io/" title="https:&#x2F;&#x2F;notes.shichao.io" rel="noopener" target="_blank">Shichao's Notes</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.shuxuele.com/" title="https:&#x2F;&#x2F;www.shuxuele.com" rel="noopener" target="_blank">数学乐</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://thispointer.com/" title="https:&#x2F;&#x2F;thispointer.com" rel="noopener" target="_blank">thisPointer</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://refactoring.guru/" title="https:&#x2F;&#x2F;refactoring.guru" rel="noopener" target="_blank">Refactoring.Guru</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://blog.imssyang.com/ProgrammingLanguage/Go/Basic.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/imssyang/windmill.png">
      <meta itemprop="name" content="Ssyang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Just Do It">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Go语言基础
            <div class="post-categories">
              [
                  <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                    <a href="/categories/ProgrammingLanguage/Go/" itemprop="url" rel="index"><span itemprop="name">Go</span></a>
                  </span>
              ]
            </div>
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 4/15/2023 13:49:22 / Modified: 20:08:30" itemprop="dateCreated datePublished" datetime="2023-04-15T13:49:22+08:00">4/15/2023</time>
    </span>

  
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>53k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>48 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>Go 基础语法梳理。</p>
<span id="more"></span>

<h1 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h1><ul>
<li>为系统编程（systems programming）而设计</li>
<li>支持强类型（strongly typed）</li>
<li>支持垃圾回收（garbage-collected）</li>
<li>支持并发编程（concurrent programming）</li>
<li>通过包（package）管理依赖关系</li>
</ul>
<h2 id="垃圾回收"><a href="#垃圾回收" class="headerlink" title="垃圾回收"></a>垃圾回收</h2><ul>
<li>内存：<ul>
<li>栈（stack）：函数执行结束时自动回收（PUSH与POP指令），开销低，效率高</li>
<li>堆（heap）：函数结束后某个时间点进行垃圾回收（GC），使用标记清除算法<ul>
<li>标记（Mark）：从根对象出发查找并标记堆中所有存活的对象，需要暂停程序（STW, stop the world）</li>
<li>清除（Sweep）：遍历堆中的全部对象，回收未被标记的垃圾对象并将回收的内存加入空闲链表</li>
</ul>
</li>
</ul>
</li>
<li>逃逸分析(escape analysis)：编译器决定内存分配位置是在stack还是heap上，作用于编译阶段<ul>
<li><strong>指针逃逸</strong>：在函数中创建一个对象，返回其指针。函数退出后，因为指针的存在，对象内存不能回收，只能分配到heap上</li>
<li><strong>动态类型逃逸</strong>：函数参数为 interface{} 时，因为其可表示任意类型，编译期间很难确定其参数的具体类型，会逃逸到heap上</li>
<li><strong>栈空间不足</strong>：操作系统对内核线程使用的栈空间是有大小限制的，64 位系统上通常是 8 MB。Go 运行时(runtime) 为 goroutine 分配的初始栈大小为 2 KB，随后动态调整栈空间。当 goroutine 被调度时，会绑定到内核线程执行，栈空间大小不会超过操作系统的限制。对 Go 编译器而言，超过一定大小（与Go版本相关）的局部变量将逃逸到heap上</li>
<li><strong>闭包（closure）</strong>：将一个函数和对其周围状态（词法环境）的引用捆绑在一起的组合。在外部函数返回后，被闭包捕获的外部变量仍需要存活着，因此逃逸到heap上</li>
</ul>
</li>
</ul>
<div class="tabs" id="go-garbage-collect"><ul class="nav-tabs"><li class="tab active"><a href="#go-garbage-collect-1">TypeEscape</a></li><li class="tab"><a href="#go-garbage-collect-2">Closure</a></li></ul><div class="tab-content"><div class="tab-pane active" id="go-garbage-collect-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newPerson</span><span class="params">(name <span class="type">string</span>)</span></span> *Person &#123;</span><br><span class="line">    p := <span class="built_in">new</span>(Person)</span><br><span class="line">    p.name = name</span><br><span class="line">    <span class="keyword">return</span> p <span class="comment">// pointer作为返回值，导致局部变量 p 逃逸到堆上</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printPerson</span><span class="params">(p *Person)</span></span> &#123;</span><br><span class="line">    fmt.Println(p.name) <span class="comment">// 函数参数为 interface&#123;&#125; 时，编译期难确定具体类型，会逃逸到堆上</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    john := newPerson(<span class="string">&quot;John&quot;</span>)</span><br><span class="line">    printPerson(john)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">$ go build -gcflags=-m ./main/c</span></span><br><span class="line"><span class="comment"># example.com/main/c</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">main/c/main.go:9:16: leaking param: name</span></span><br><span class="line"><span class="comment">main/c/main.go:10:10: new(Person) escapes to heap</span></span><br><span class="line"><span class="comment">main/c/main.go:15:18: leaking param content: p</span></span><br><span class="line"><span class="comment">main/c/main.go:16:13: ... argument does not escape</span></span><br><span class="line"><span class="comment">main/c/main.go:16:15: p.name escapes to heap</span></span><br><span class="line"><span class="comment">main/c/main.go:20:19: new(Person) does not escape</span></span><br><span class="line"><span class="comment">main/c/main.go:21:13: ... argument does not escape</span></span><br><span class="line"><span class="comment">main/c/main.go:21:13: p.name escapes to heap</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-garbage-collect-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Increase</span><span class="params">()</span></span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    n := <span class="number">0</span> <span class="comment">// n 会一直存在，直到 in 被销毁（逃逸到heap）</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">        n++</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    in := Increase()</span><br><span class="line">    fmt.Println(in()) <span class="comment">// 1</span></span><br><span class="line">    fmt.Println(in()) <span class="comment">// 2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">$ go build -gcflags=-m ./main/d</span></span><br><span class="line"><span class="comment"># example.com/main/d</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">main/d/main.go:6:2: moved to heap: n</span></span><br><span class="line"><span class="comment">main/d/main.go:7:9: func literal escapes to heap</span></span><br><span class="line"><span class="comment">main/d/main.go:14:16: func literal does not escape</span></span><br><span class="line"><span class="comment">main/d/main.go:15:13: ... argument does not escape</span></span><br><span class="line"><span class="comment">main/d/main.go:15:16: ~R0 escapes to heap</span></span><br><span class="line"><span class="comment">main/d/main.go:16:13: ... argument does not escape</span></span><br><span class="line"><span class="comment">main/d/main.go:16:16: ~R0 escapes to heap</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></div></div></div>

<h1 id="风格（idiom）"><a href="#风格（idiom）" class="headerlink" title="风格（idiom）"></a>风格（idiom）</h1><ul>
<li>gofmt 对 package（不是 file）代码进行格式化<ul>
<li>制表符（tab）用于缩进（indentation）</li>
<li>没有行长度限制，必要时换行后用 tab 控制缩进</li>
<li>语法上很少需要小括号（parentheses），更简洁</li>
<li>注释支持<code>C-style /* */</code>和<code>C++-style //</code></li>
<li>命名约定（naming conventions）<ul>
<li>包名（package name）：作为内容的访问器（accessor），通常是 lower case, single-word<ul>
<li>包名也是源目录的名称，例如调用 src&#x2F;encoding&#x2F;base64.go 的代码为<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;encoding/base64&quot;</span></span><br><span class="line">base64.xxx()</span><br></pre></td></tr></table></figure></li>
<li>避免使用<code>import .</code></li>
</ul>
</li>
<li>多个单词：使用<code>MixedCaps</code>或<code>mixedCaps</code>，而非<code>mixed_caps</code></li>
<li>getter 和 setter<ul>
<li>对于 owner 字段，其 getter 命名应为<code>Owner()</code>，setter 命名为<code>SetOwner()</code></li>
</ul>
</li>
<li>one-method 接口通常加<code>-er</code>后缀：<code>Reader, Writer, Formatter, CloseNotifier</code></li>
</ul>
</li>
<li>词法分析器（lexer）会自动为语句添加分号（c-like, semicolon）作为结束标记<ul>
<li>如果换行符（newline）出现在可以结束语句的标记（token）之后，就插入一个 semicolon</li>
<li>禁止将控制结构（<code>if, for, switch or select</code>）的起始大括号（opening brace）放到新行<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> i &lt; f() <span class="comment">// wrong! will insert a semicolon!</span></span><br><span class="line">&#123; <span class="comment">// wrong!</span></span><br><span class="line">    g()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="数据（data）"><a href="#数据（data）" class="headerlink" title="数据（data）"></a>数据（data）</h1><ul>
<li>默认值为 zero-value：<ul>
<li>boolean：<code>false</code></li>
<li>numeric: <code>0</code></li>
<li>string: <code>&quot;&quot;</code></li>
<li>pointer, function, interface, slice, channel, map: <code>nil</code></li>
</ul>
</li>
<li>两个 allocation 函数：<code>new</code>和<code>make</code><ul>
<li><code>new(T)</code>分配 zero 存储空间然后返回它的地址（pointer, <code>*T</code>），即 new 不会初始化内存<ul>
<li>返回 local 变量的地址是合法的，局部变量的内存在函数返回后依然存在</li>
</ul>
</li>
<li><code>make(T, args)</code>返回 T 类型相关的初始化内存后的值（not pointer, <code>*T</code>）<ul>
<li>make 通常只用于 slice、map 和 channel，这三个类型也是必须初始化内存才有意义的</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="tabs" id="go-data"><ul class="nav-tabs"><li class="tab active"><a href="#go-data-1">DefaultValue</a></li><li class="tab"><a href="#go-data-2">new & make</a></li></ul><div class="tab-content"><div class="tab-pane active" id="go-data-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> T <span class="keyword">struct</span> &#123;</span><br><span class="line">    b <span class="type">bool</span></span><br><span class="line">    i <span class="type">int</span></span><br><span class="line">    f <span class="type">float64</span></span><br><span class="line">    s <span class="type">string</span></span><br><span class="line">    a [<span class="number">3</span>]<span class="type">int</span></span><br><span class="line">    c []<span class="type">float32</span></span><br><span class="line">    t <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">    p *T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    t := <span class="built_in">new</span>(T)</span><br><span class="line">    fmt.Println(t.b) <span class="comment">// false</span></span><br><span class="line">    fmt.Println(t.i) <span class="comment">// 0</span></span><br><span class="line">    fmt.Println(t.f) <span class="comment">// 0.0</span></span><br><span class="line">    fmt.Println(t.s) <span class="comment">// &quot;&quot;</span></span><br><span class="line">    fmt.Println(t.a) <span class="comment">// [0 0 0]</span></span><br><span class="line">    fmt.Println(t.c) <span class="comment">// []</span></span><br><span class="line">    fmt.Println(t.t) <span class="comment">// &#123;&#125;</span></span><br><span class="line">    fmt.Println(t.p) <span class="comment">// nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-data-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p *[]<span class="type">int</span> = <span class="built_in">new</span>([]<span class="type">int</span>)       <span class="comment">// allocates slice structure; *p == nil; rarely useful</span></span><br><span class="line"><span class="keyword">var</span> v  []<span class="type">int</span> = <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">100</span>) <span class="comment">// the slice v now refers to a new array of 100 ints</span></span><br></pre></td></tr></table></figure></div></div></div>

<h2 id="const"><a href="#const" class="headerlink" title="const"></a>const</h2><ul>
<li>常量（constant）使用<code>const</code>关键字定义<ul>
<li>支持表达式方式，在编译时求值。例如<code>const A = 1&lt;&lt;3</code></li>
</ul>
</li>
<li>枚举（enumerate）常量通过<code>iota</code>定义，其初始值为 0</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ByteSize <span class="type">float64</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    _           = <span class="literal">iota</span> <span class="comment">// ignore</span></span><br><span class="line">    KB ByteSize = <span class="number">1</span> &lt;&lt; (<span class="number">10</span> * <span class="literal">iota</span>)</span><br><span class="line">    MB</span><br><span class="line">    GB</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b ByteSize)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> b &gt;= GB:</span><br><span class="line">        <span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%.2fGB&quot;</span>, b/GB)</span><br><span class="line">    <span class="keyword">case</span> b &gt;= MB:</span><br><span class="line">        <span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%.2fMB&quot;</span>, b/MB)</span><br><span class="line">    <span class="keyword">case</span> b &gt;= KB:</span><br><span class="line">        <span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%.2fKB&quot;</span>, b/KB)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%.2fB&quot;</span>, b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    bs := ByteSize(<span class="number">10000000000</span>)</span><br><span class="line">    fmt.Println(KB, MB, GB, bs.String())  <span class="comment">// 1.00KB 1.00MB 1.00GB 9.31GB</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> (</span><br><span class="line">        a = <span class="literal">iota</span></span><br><span class="line">        b</span><br><span class="line">        c</span><br><span class="line">        d = <span class="string">&quot;A&quot;</span></span><br><span class="line">        e</span><br><span class="line">        f = <span class="literal">iota</span></span><br><span class="line">        g</span><br><span class="line">    )</span><br><span class="line">    fmt.Println(a, b, c, d, e, f, g) <span class="comment">// 0 1 2 A A 5 6</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="variable"><a href="#variable" class="headerlink" title="variable"></a>variable</h2><ul>
<li>变量（variable）使用<code>var</code>关键字定义<ul>
<li>支持表达式方式，在运行时求值</li>
</ul>
</li>
<li>变量的静态类型（static type）是在声明时确定的<ul>
<li>当静态类型为 interface 时，变量在运行时还会有动态类型（dynamic type），动态类型由赋值给接口的值的类型来决定</li>
</ul>
</li>
</ul>
<div class="tabs" id="go-var"><ul class="nav-tabs"><li class="tab active"><a href="#go-var-1">DynamicType</a></li><li class="tab"><a href="#go-var-2">Environ</a></li><li class="tab"><a href="#go-var-3">InitOrder</a></li></ul><div class="tab-content"><div class="tab-pane active" id="go-var-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> x <span class="keyword">interface</span>&#123;&#125; <span class="comment">// Variable declarations</span></span><br><span class="line">    a := <span class="number">1</span>            <span class="comment">// Short variable declarations</span></span><br><span class="line">    <span class="keyword">var</span> b *<span class="type">int</span> = &amp;a</span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%v %T\n&quot;</span>, x, x) <span class="comment">// 0 int</span></span><br><span class="line">    x = a</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%v %T\n&quot;</span>, x, x) <span class="comment">// 1 int</span></span><br><span class="line">    x = b</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%v %T\n&quot;</span>, x, x) <span class="comment">// 0xc00001c150 *int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-var-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    home   = os.Getenv(<span class="string">&quot;HOME&quot;</span>)</span><br><span class="line">    user   = os.Getenv(<span class="string">&quot;USER&quot;</span>)</span><br><span class="line">    gopath = os.Getenv(<span class="string">&quot;GOPATH&quot;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(home)   <span class="comment">// /root</span></span><br><span class="line">    fmt.Println(user)   <span class="comment">// root</span></span><br><span class="line">    fmt.Println(gopath) <span class="comment">// /opt/go/app</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-var-3"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    a = c + b <span class="comment">// 9</span></span><br><span class="line">    b = f()   <span class="comment">// 4</span></span><br><span class="line">    c = f()   <span class="comment">// 5</span></span><br><span class="line">    d = <span class="number">3</span>     <span class="comment">// 5 (initialization has finished)</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    d++</span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">g</span><span class="params">()</span></span> (<span class="type">int</span>, <span class="type">int</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>, <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(a, b, c, d) <span class="comment">// 9 4 5 5</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> i, j = g()</span><br><span class="line">    <span class="keyword">var</span> _, k = g()</span><br><span class="line">    fmt.Println(i, j, k) <span class="comment">// 1 2 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>

<h1 id="作用域（scope）"><a href="#作用域（scope）" class="headerlink" title="作用域（scope）"></a>作用域（scope）</h1><ul>
<li>包级别作用域（Package-level scope）：指变量、常量和函数在整个包内都可以访问<ul>
<li>名称必须以大写字母开头，表示它们是可导出的（exported），可以在其他包中使用</li>
</ul>
</li>
<li>文件级别作用域（File-level scope）：指变量、常量和函数在当前文件内都可以访问<ul>
<li>名称必须以小写字母开头，表示它们是私有的（unexported），只能在当前文件内使用</li>
</ul>
</li>
<li>块级别作用域（Block-level scope）：指变量在当前代码块（包括函数、循环、判断等）内部可访问<ul>
<li>名称必须以小写字母开头</li>
</ul>
</li>
<li>函数参数作用域（Function parameter scope）：指函数参数在函数内部可访问<ul>
<li>名称必须以小写字母开头</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Package-level scope: X, Foo</span></span><br><span class="line"><span class="keyword">var</span> X <span class="type">int</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Foo</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Foo&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// File-level scope: y, bar</span></span><br><span class="line"><span class="keyword">var</span> y <span class="type">int</span> = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bar</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;bar&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// Block-level scope: i</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1</span>; i++ &#123;</span><br><span class="line">        <span class="comment">// Function parameter scope: j</span></span><br><span class="line">        <span class="function"><span class="keyword">func</span><span class="params">(j <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">            fmt.Println(X) <span class="comment">// 1</span></span><br><span class="line">            Foo()          <span class="comment">// Foo</span></span><br><span class="line"></span><br><span class="line">            fmt.Println(y) <span class="comment">// 2</span></span><br><span class="line">            bar()          <span class="comment">// bar</span></span><br><span class="line"></span><br><span class="line">            fmt.Println(j) <span class="comment">// 0</span></span><br><span class="line">        &#125;(i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="类型（type）"><a href="#类型（type）" class="headerlink" title="类型（type）"></a>类型（type）</h1><ul>
<li>两个类型相同（identical）的条件：<ul>
<li>数组（array）的元素类型（type)相同且数组长度（length）相同</li>
<li>切片（slice）的元素类型（type)相同</li>
<li>结构（struct）的各个 field 有相同的 type、name、tag，且 field 的序列顺序也是相同的</li>
<li>指针（pointer）的基本类型是相同的</li>
<li>函数（function）的参数（parameters）和返回值（result values）是相同的</li>
<li>接口（interface）的类型集（type set）是相同的</li>
<li>映射（map）的 key 和元素类型是相同的</li>
<li>通道（channel）的 direction 和元素类型是相同的</li>
</ul>
</li>
</ul>
<h2 id="种类"><a href="#种类" class="headerlink" title="种类"></a>种类</h2><h3 id="Boolean"><a href="#Boolean" class="headerlink" title="Boolean"></a>Boolean</h3><ul>
<li><code>bool</code>: <code>false</code>, <code>true</code></li>
</ul>
<h3 id="Numeric"><a href="#Numeric" class="headerlink" title="Numeric"></a>Numeric</h3><table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>uint8 | byte</code></td>
<td align="left">8-bit unsigned integer (0 to 255)</td>
</tr>
<tr>
<td align="left"><code>uint16</code></td>
<td align="left">16-bit unsigned integer (0 to 65535)</td>
</tr>
<tr>
<td align="left"><code>uint32</code></td>
<td align="left">32-bit unsigned integer (0 to 4294967295)</td>
</tr>
<tr>
<td align="left"><code>uint64</code></td>
<td align="left">64-bit unsigned integer (0 to 18446744073709551615)</td>
</tr>
<tr>
<td align="left"><code>uint</code></td>
<td align="left">32 or 64 bits unsigned integer (取决于实现)</td>
</tr>
<tr>
<td align="left"><code>uintptr</code></td>
<td align="left">an unsigned integer large enough to store the uninterpreted bits of a pointer value</td>
</tr>
<tr>
<td align="left"><code>int8</code></td>
<td align="left">8-bit signed integer (-128 to 127)</td>
</tr>
<tr>
<td align="left"><code>int16</code></td>
<td align="left">16-bit signed integer (-32768 to 32767)</td>
</tr>
<tr>
<td align="left"><code>int32 | rune</code></td>
<td align="left">32-bit signed integer (-2147483648 to 2147483647)</td>
</tr>
<tr>
<td align="left"><code>int64</code></td>
<td align="left">64-bit signed integer (-9223372036854775808 to 9223372036854775807)</td>
</tr>
<tr>
<td align="left"><code>int</code></td>
<td align="left">32 or 64 bits signed integer (取决于实现)</td>
</tr>
<tr>
<td align="left"><code>float32</code></td>
<td align="left">32-bit floating-point number (IEEE-754)</td>
</tr>
<tr>
<td align="left"><code>float64</code></td>
<td align="left">64-bit floating-point number (IEEE-754)</td>
</tr>
<tr>
<td align="left"><code>complex64</code></td>
<td align="left">complex number with float32 real and imaginary part</td>
</tr>
<tr>
<td align="left"><code>complex128</code></td>
<td align="left">complex number with float64 real and imaginary part</td>
</tr>
</tbody></table>
<h4 id="integer"><a href="#integer" class="headerlink" title="integer"></a>integer</h4><ul>
<li>整型常量要求能表示 32byte 大小的范围，通常不会溢出</li>
<li>整型常量支持二进制、八进制、十进制和十六进制表示</li>
<li><code>_</code>可以放到连续的数字之间，以增加可读性，但不影响字面值</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="number">12</span>, <span class="number">1</span>_2)                   <span class="comment">// 12 12 (decimal)</span></span><br><span class="line">    fmt.Println(<span class="number">0</span>b11, <span class="number">0</span>b11, <span class="number">0</span>b1_1)         <span class="comment">// 3 3 3 (binary)</span></span><br><span class="line">    fmt.Println(<span class="number">012</span>, <span class="number">0</span>_12, <span class="number">0</span>o12, <span class="number">0</span>o12)     <span class="comment">// 10 10 10 10 (octal)</span></span><br><span class="line">    fmt.Println(<span class="number">0x12</span>, <span class="number">0x12</span>, <span class="number">0x1</span>_2, <span class="number">0</span>x_1_2) <span class="comment">// 18 18 18 18 (hexadecimal)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="溢出（overflow）"><a href="#溢出（overflow）" class="headerlink" title="溢出（overflow）"></a>溢出（overflow）</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> a, b <span class="type">uint8</span> = math.MaxUint8, <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> c <span class="type">uint8</span> = a + b</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T %v\n&quot;</span>, c, c) <span class="comment">// uint8 0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> d <span class="type">uint16</span> = <span class="type">uint16</span>(a) + <span class="type">uint16</span>(b)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T %v\n&quot;</span>, d, d) <span class="comment">// uint16 256</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="float"><a href="#float" class="headerlink" title="float"></a>float</h4><ul>
<li>浮点型常量的小数部分要求能表示 32byte 大小的范围，指数部分能表示 2byte 大小的范围，通常不会溢出</li>
<li>浮点型常量只支持十进制和十六进制表示</li>
<li><code>_</code>可以放到连续的数字之间，以增加可读性，但不影响字面值</li>
<li>科学计数法的指数部分，以 10 为底数时用<code>e</code>表示，以 2 为底数时用<code>p</code>表示<ul>
<li><code>1.23e+3 = 1.23 x 10^3 = 1230</code></li>
<li><code>0x1.8p+2 = (1+8/16)x2^2 = 6</code></li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="number">1.23</span>, <span class="number">1.230</span>, <span class="number">01.230</span>)                 <span class="comment">// 1.23 1.23 1.23 (decimal)</span></span><br><span class="line">    fmt.Println(<span class="number">1.</span>, <span class="number">.23</span>, <span class="number">.2</span>_3)                       <span class="comment">// 1 0.23 0.23 (decimal)</span></span><br><span class="line">    fmt.Println(<span class="number">1.e+0</span>, <span class="number">1.23e+0</span>, <span class="number">1.23e+1</span>, <span class="number">1.23e+3</span>)    <span class="comment">// 1 1.23 12.3 1230 (decimal)</span></span><br><span class="line">    fmt.Println(<span class="number">0x1</span>p<span class="number">-2</span>, <span class="number">0x1</span>p<span class="number">-1</span>, <span class="number">0x1</span>p0, <span class="number">0x1</span>p1, <span class="number">0x1</span>p2) <span class="comment">// 0.25 0.5 1 2 4 (hexadecimal)</span></span><br><span class="line">    fmt.Println(<span class="number">0x1</span><span class="number">.8</span>p+<span class="number">0</span>, <span class="number">0x1</span><span class="number">.8</span>p+<span class="number">1</span>, <span class="number">0x1</span><span class="number">.8</span>p+<span class="number">2</span>)        <span class="comment">// 1.5 3 6 (hexadecimal)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="imaginary"><a href="#imaginary" class="headerlink" title="imaginary"></a>imaginary</h4><ul>
<li>虚数支持 integer 和 float 的表示形式，后缀<code>i</code>表示</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="number">12i</span>, <span class="number">0</span>b11i, <span class="number">0</span>o12i, <span class="number">0x12i</span>)              <span class="comment">// 12i 3i 10i 18i</span></span><br><span class="line">    fmt.Println(<span class="number">1.23i</span>, <span class="number">1.i</span>, <span class="number">.23i</span>, <span class="number">1.23e+3i</span>, <span class="number">0x1</span><span class="number">.8</span>p+<span class="number">2i</span>) <span class="comment">// 1.23i 1i 0.23i 1230i 6i</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="rune"><a href="#rune" class="headerlink" title="rune"></a>rune</h4><ul>
<li>字符字面量（literal）通过<code>&#39;&#39;</code>表示，支持八进制、十六进制、Unicode 码点、特殊转义字符的表示形式</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&#x27;\a&#x27;</span>, <span class="string">&#x27;\u0007&#x27;</span>) <span class="comment">// 7 7 (alert or bell)</span></span><br><span class="line">    fmt.Println(<span class="string">&#x27;\b&#x27;</span>, <span class="string">&#x27;\u0008&#x27;</span>) <span class="comment">// 8 8 (backspace)</span></span><br><span class="line">    fmt.Println(<span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\u0009&#x27;</span>) <span class="comment">// 9 9 (horizontal tab)</span></span><br><span class="line">    fmt.Println(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\u000A&#x27;</span>) <span class="comment">// 10 10 (line feed or newline)</span></span><br><span class="line">    fmt.Println(<span class="string">&#x27;\v&#x27;</span>, <span class="string">&#x27;\u000B&#x27;</span>) <span class="comment">// 11 11 (vertical tab)</span></span><br><span class="line">    fmt.Println(<span class="string">&#x27;\f&#x27;</span>, <span class="string">&#x27;\u000C&#x27;</span>) <span class="comment">// 12 12 (form feed)</span></span><br><span class="line">    fmt.Println(<span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\u000D&#x27;</span>) <span class="comment">// 13 13 (carriage return)</span></span><br><span class="line">    fmt.Println(<span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;\u005C&#x27;</span>) <span class="comment">// 92 92 (backslash)</span></span><br><span class="line">    fmt.Println(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\u0027&#x27;</span>) <span class="comment">// 39 39 (single quote)</span></span><br><span class="line">    fmt.Println(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\u0022&#x27;</span>)  <span class="comment">// 34 34 (double quote)</span></span><br><span class="line">    fmt.Println(<span class="string">&#x27;\377&#x27;</span>)         <span class="comment">// 255</span></span><br><span class="line">    fmt.Println(<span class="string">&#x27;\xff&#x27;</span>)         <span class="comment">// 255</span></span><br><span class="line">    fmt.Println(<span class="string">&#x27;\u00ff&#x27;</span>)       <span class="comment">// 255</span></span><br><span class="line">    fmt.Println(<span class="string">&#x27;\U000000ff&#x27;</span>)   <span class="comment">// 255</span></span><br><span class="line">    fmt.Println(<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;a&#x27;</span>)  <span class="comment">// 48 65 97</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><ul>
<li>字符串（string）是不可变的（immutable），长度通过内建函数<code>len()</code>获取<ul>
<li>拼接字符串应优先用<code>strings.Builder、bytes.Buffer或[]byte</code>，以避免不断创建新的字符串<ul>
<li><code>strings.Builder</code> 和 <code>bytes.Buffer</code> 底层都是 <code>[]byte</code> 数组</li>
</ul>
</li>
</ul>
</li>
<li>字符串的值可看成由<code>byte</code>组成的数组，通过索引可访问字符（<code>s[i]</code>），但是不允许对索引的字符取地址（<code>&amp;s[i]</code>）</li>
<li>字符串字面量（literal）通过<code>&quot;&quot;</code>或&#96;&#96;表示，同时支持混合字符常量</li>
</ul>
<div class="tabs" id="go-type-string"><ul class="nav-tabs"><li class="tab active"><a href="#go-type-string-1">Basic</a></li><li class="tab"><a href="#go-type-string-2">Concat</a></li></ul><div class="tab-content"><div class="tab-pane active" id="go-type-string-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// variable</span></span><br><span class="line">    <span class="keyword">var</span> a <span class="type">string</span> = <span class="string">&quot;xyz&quot;</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%d %s %c %c\n&quot;</span>, <span class="built_in">len</span>(a), a, a[<span class="number">0</span>], a[<span class="number">2</span>]) <span class="comment">// 3 xyz x z</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// literal</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;ab&quot;</span>, <span class="string">`ab`</span>) <span class="comment">// ab ab</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;a\tb&quot;</span>, <span class="string">`a	b`</span>) <span class="comment">// a	b a	b</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;[\u00ff]&quot;</span>) <span class="comment">// [ÿ]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-type-string-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;bytes&quot;</span></span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ConcatByBuilder</span><span class="params">(s <span class="type">string</span>, n <span class="type">int</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> builder strings.Builder</span><br><span class="line">    builder.Grow(n * <span class="built_in">len</span>(s)) <span class="comment">// Preallocated memory</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        builder.WriteString(s)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> builder.String()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ConcatByBuffer</span><span class="params">(s <span class="type">string</span>, n <span class="type">int</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">    buf := <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        buf.WriteString(s)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> buf.String()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ConcatByByte</span><span class="params">(n <span class="type">int</span>, str <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">    buf := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        buf = <span class="built_in">append</span>(buf, str...)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">string</span>(buf)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>

<h3 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h3><ul>
<li>数组的赋值会拷贝所有的元素，因此函数参数中传递指针更有效率</li>
<li>数组的 length 作为数组类型（type）的一部分看待（固定长度）<ul>
<li><code>[10]int</code>和<code>[20]int</code>是不同的类型</li>
</ul>
</li>
</ul>
<div class="tabs" id="go-type-array"><ul class="nav-tabs"><li class="tab active"><a href="#go-type-array-1">Basic</a></li><li class="tab"><a href="#go-type-array-2">AsFuncParam</a></li></ul><div class="tab-content"><div class="tab-pane active" id="go-type-array-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// Init</span></span><br><span class="line">    a := [<span class="number">3</span>]<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;                              <span class="comment">// array (显式size)</span></span><br><span class="line">    b := [...]<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;                            <span class="comment">// array (隐式size)</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%d %d %T %v\n&quot;</span>, <span class="built_in">cap</span>(a), <span class="built_in">len</span>(a), a, a) <span class="comment">// 3 3 [3]int [1 2 3]</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%d %d %T %v\n&quot;</span>, <span class="built_in">cap</span>(b), <span class="built_in">len</span>(b), b, b) <span class="comment">// 3 3 [3]int [1 2 3]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ToSlice</span></span><br><span class="line">    <span class="keyword">var</span> c []<span class="type">int</span> = a[<span class="number">1</span>:<span class="number">3</span>]                              <span class="comment">// slice</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%d %d %T %v\n&quot;</span>, <span class="built_in">cap</span>(c), <span class="built_in">len</span>(c), c, c) <span class="comment">// 3 2 []int [2 3]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-type-array-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sum</span><span class="params">(a *[3]<span class="type">float64</span>)</span></span> (sum <span class="type">float64</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> *a &#123;</span><br><span class="line">        sum += v</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">array := [...]<span class="type">float64</span>&#123;<span class="number">7.0</span>, <span class="number">8.5</span>, <span class="number">9.1</span>&#125;</span><br><span class="line">x := Sum(&amp;array)  <span class="comment">// Note the explicit address-of operator</span></span><br></pre></td></tr></table></figure></div></div></div>

<h3 id="Slice"><a href="#Slice" class="headerlink" title="Slice"></a>Slice</h3><ul>
<li>切片（slice）是对数组的更高维度的封装，以对序列号数据的操作提供更通用、强大且便利的接口<ul>
<li>单维度数组操作通常都是以 Slice 形式存在</li>
</ul>
</li>
<li>切片支持动态扩容，当底层 Array 大小不够用时，会重新分配 2 倍大小空间的 Array，然后将所有元素拷贝到新空间</li>
<li>切片的赋值并不会拷贝底层 Array，它们都指向同一个数组<ul>
<li>函数传参通过 Slice，也就类似于通过<code>*Array</code>，函数内外修改数组中的元素是相互影响的</li>
<li><strong>GC 陷阱</strong>：当底层数组占用的内存已经很大后，仍存在一小段切片在使用，那么这段很大的内存不会被释放</li>
</ul>
</li>
<li>切片类型的值只能转换为与其元素类型相同的切片类型，而不能转换为任何类型的切片<ul>
<li><code>[]int</code>不能直接传递给<code>[]any</code>（报错），可以先转换成<code>[]interface&#123;&#125;</code>后再传递给<code>[]any</code></li>
</ul>
</li>
</ul>
<div class="tabs" id="go-type-slice"><ul class="nav-tabs"><li class="tab active"><a href="#go-type-slice-1">Basic</a></li><li class="tab"><a href="#go-type-slice-2">Transform</a></li><li class="tab"><a href="#go-type-slice-3">AppendImpl</a></li><li class="tab"><a href="#go-type-slice-4">GCProblem</a></li></ul><div class="tab-content"><div class="tab-pane active" id="go-type-slice-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    a := []<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">    b := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line">    c := <span class="built_in">new</span>([<span class="number">5</span>]<span class="type">int</span>)[<span class="number">0</span>:<span class="number">3</span>]</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%d %d %T %v\n&quot;</span>, <span class="built_in">cap</span>(a), <span class="built_in">len</span>(a), a, a) <span class="comment">// 3 3 []int [1 2 3]</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%d %d %T %v\n&quot;</span>, <span class="built_in">cap</span>(b), <span class="built_in">len</span>(b), b, b) <span class="comment">// 5 3 []int [0 0 0]</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%d %d %T %v\n&quot;</span>, <span class="built_in">cap</span>(c), <span class="built_in">len</span>(c), c, c) <span class="comment">// 5 3 []int [0 0 0]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// modify</span></span><br><span class="line">    a[<span class="number">1</span>] = <span class="number">22</span></span><br><span class="line">    fmt.Println(a) <span class="comment">// [1 22 3]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// add</span></span><br><span class="line">    d := <span class="built_in">append</span>(a, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">    fmt.Println(a, d) <span class="comment">// [1 22 3] [1 22 3 4 5]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// delete (注意c和d共享同一个底层array)</span></span><br><span class="line">    c = <span class="built_in">append</span>(d[:<span class="number">1</span>], d[<span class="number">2</span>:]...)</span><br><span class="line">    fmt.Println(c, d) <span class="comment">// [1 3 4 5] [1 3 4 5 5]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// truncate</span></span><br><span class="line">    e := d[<span class="number">1</span>:<span class="number">4</span>]</span><br><span class="line">    fmt.Println(e) <span class="comment">// [3 4 5]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// copy</span></span><br><span class="line">    <span class="built_in">copy</span>(b, a)</span><br><span class="line">    fmt.Println(a, b) <span class="comment">// [1 22 3] [1 22 3]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// spreading</span></span><br><span class="line">    f := []<span class="keyword">interface</span>&#123;&#125;&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">    fmt.Println(f)    <span class="comment">// [1 2 3]</span></span><br><span class="line">    fmt.Println(f...) <span class="comment">// 1 2 3 (切片展开)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// traversal</span></span><br><span class="line">    <span class="keyword">for</span> i, v := <span class="keyword">range</span> a &#123;</span><br><span class="line">        fmt.Println(i, v) <span class="comment">// 0 1  1 22  2 3</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// isEmpty</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(a) == <span class="number">0</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;slice is empty&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// isEqual</span></span><br><span class="line">    <span class="keyword">if</span> reflect.DeepEqual(a, b) &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%d %v equal %d %v\n&quot;</span>, <span class="built_in">cap</span>(a), a, <span class="built_in">cap</span>(b), b) <span class="comment">// 3 [1 22 3] equal 5 [1 22 3]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-type-slice-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// SliceToArray</span></span><br><span class="line">    a := []<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;      <span class="comment">// slice</span></span><br><span class="line">    b := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="built_in">len</span>(a)) <span class="comment">// array</span></span><br><span class="line">    <span class="built_in">copy</span>(b, a)</span><br><span class="line">    fmt.Println(a, b) <span class="comment">// [1 2 3] [1 2 3]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ArrayToSlice</span></span><br><span class="line">    c := [<span class="number">3</span>]<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125; <span class="comment">// array</span></span><br><span class="line">    d := c[:]            <span class="comment">// slice</span></span><br><span class="line">    fmt.Println(c, d)    <span class="comment">// [1 2 3] [1 2 3]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-type-slice-3"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Append</span><span class="params">(slice, data []<span class="type">byte</span>)</span></span> []<span class="type">byte</span> &#123;</span><br><span class="line">    l := <span class="built_in">len</span>(slice)</span><br><span class="line">    <span class="keyword">if</span> l + <span class="built_in">len</span>(data) &gt; <span class="built_in">cap</span>(slice) &#123;  <span class="comment">// reallocate</span></span><br><span class="line">        <span class="comment">// Allocate double what&#x27;s needed, for future growth.</span></span><br><span class="line">        newSlice := <span class="built_in">make</span>([]<span class="type">byte</span>, (l+<span class="built_in">len</span>(data))*<span class="number">2</span>)</span><br><span class="line">        <span class="comment">// The copy function is predeclared and works for any slice type.</span></span><br><span class="line">        <span class="built_in">copy</span>(newSlice, slice)</span><br><span class="line">        slice = newSlice</span><br><span class="line">    &#125;</span><br><span class="line">    slice = slice[<span class="number">0</span>:l+<span class="built_in">len</span>(data)]</span><br><span class="line">    <span class="built_in">copy</span>(slice[l:], data)</span><br><span class="line">    <span class="keyword">return</span> slice</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-type-slice-4"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dep/slice.go</span></span><br><span class="line"><span class="keyword">package</span> dep</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">LastNumsBySlice</span><span class="params">(origin []<span class="type">int</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> origin[<span class="built_in">len</span>(origin)<span class="number">-2</span>:]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">LastNumsByCopy</span><span class="params">(origin []<span class="type">int</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">    result := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">2</span>)</span><br><span class="line">    <span class="built_in">copy</span>(result, origin[<span class="built_in">len</span>(origin)<span class="number">-2</span>:])</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// dep/slice_test.go</span></span><br><span class="line"><span class="keyword">package</span> dep_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;math/rand&quot;</span></span><br><span class="line">    <span class="string">&quot;runtime&quot;</span></span><br><span class="line">    <span class="string">&quot;testing&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;example.com/dep&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init1MB</span><span class="params">()</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">    rand.Seed(time.Now().UnixNano())</span><br><span class="line">    n := <span class="number">128</span> * <span class="number">1024</span> <span class="comment">//1M in x64 machine</span></span><br><span class="line">    nums := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, n)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        nums = <span class="built_in">append</span>(nums, rand.Int())</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> nums</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printMem</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    t.Helper()</span><br><span class="line">    <span class="keyword">var</span> m runtime.MemStats</span><br><span class="line">    runtime.ReadMemStats(&amp;m)</span><br><span class="line">    t.Logf(<span class="string">&quot;%.2f MB&quot;</span>, <span class="type">float64</span>(m.Alloc)/<span class="number">1024.</span>/<span class="number">1024.</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testF</span><span class="params">(t *testing.T, f <span class="keyword">func</span>([]<span class="type">int</span>)</span></span> []<span class="type">int</span>) &#123;</span><br><span class="line">    t.Helper()</span><br><span class="line">    r := <span class="built_in">make</span>([][]<span class="type">int</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">        origin := init1MB()</span><br><span class="line">        r = <span class="built_in">append</span>(r, f(origin))</span><br><span class="line">        <span class="comment">// runtime.GC() // (maybe)</span></span><br><span class="line">    &#125;</span><br><span class="line">    printMem(t)</span><br><span class="line">    _ = r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestLastNumsBySlice</span><span class="params">(t *testing.T)</span></span> &#123; testF(t, dep.LastNumsBySlice) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestLastNumsByCopy</span><span class="params">(t *testing.T)</span></span>  &#123; testF(t, dep.LastNumsByCopy) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">$ go test -run=&quot;TestLast&quot; . -v</span></span><br><span class="line"><span class="comment">=== RUN   TestLastNumsBySlice slice_test.go:40: 100.12 MB</span></span><br><span class="line"><span class="comment">=== RUN   TestLastNumsByCopy slice_test.go:41: 2.13 MB</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></div></div></div>

<h4 id="切片表达式（slice-expression）"><a href="#切片表达式（slice-expression）" class="headerlink" title="切片表达式（slice expression）"></a>切片表达式（slice expression）</h4><ul>
<li>简单的（Simple）<ul>
<li><code>a[low:high]</code>：截取下标从 low 到 high-1 的元素，返回一个新的切片<ul>
<li>如果 low 或 high 被省略，则默认为 0 或切片的长度</li>
<li><code>a[:]</code> 返回一个包含所有切片元素的新切片</li>
</ul>
</li>
</ul>
</li>
<li>完全的（Full）<ul>
<li><code>a[low:high:max]</code>：其中 low 和 high 的含义与 Simple 相同，max 表示新切片的容量上限<ul>
<li>如果 max 被省略，则默认为切片的容量</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := []<span class="type">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line">    fmt.Println(a, <span class="built_in">len</span>(a), <span class="built_in">cap</span>(a)) <span class="comment">// [0 1 2 3 4 5] 6 6</span></span><br><span class="line"></span><br><span class="line">    b := a[<span class="number">2</span>:<span class="number">4</span>]</span><br><span class="line">    fmt.Println(b, <span class="built_in">len</span>(b), <span class="built_in">cap</span>(b)) <span class="comment">// [2 3] 2 4</span></span><br><span class="line"></span><br><span class="line">    c := a[<span class="number">3</span>:]</span><br><span class="line">    fmt.Println(c, <span class="built_in">len</span>(c), <span class="built_in">cap</span>(c)) <span class="comment">// [3 4 5] 3 3</span></span><br><span class="line"></span><br><span class="line">    d := a[:<span class="number">3</span>]</span><br><span class="line">    fmt.Println(d, <span class="built_in">len</span>(d), <span class="built_in">cap</span>(d)) <span class="comment">// [0 1 2] 3 6</span></span><br><span class="line"></span><br><span class="line">    e := a[:]</span><br><span class="line">    fmt.Println(e, <span class="built_in">len</span>(e), <span class="built_in">cap</span>(e)) <span class="comment">// [0 1 2 3 4 5] 6 6</span></span><br><span class="line"></span><br><span class="line">    f := a[<span class="number">2</span>:<span class="number">4</span>:<span class="number">4</span>]</span><br><span class="line">    fmt.Println(f, <span class="built_in">len</span>(f), <span class="built_in">cap</span>(f)) <span class="comment">// [2 3] 2 2</span></span><br><span class="line"></span><br><span class="line">    g := a[<span class="number">2</span>:<span class="number">4</span>:<span class="number">6</span>]</span><br><span class="line">    fmt.Println(g, <span class="built_in">len</span>(g), <span class="built_in">cap</span>(g)) <span class="comment">// [2 3] 2 4</span></span><br><span class="line"></span><br><span class="line">    h := <span class="built_in">append</span>(a[:<span class="number">2</span>], a[<span class="number">4</span>:]...)</span><br><span class="line">    fmt.Println(h, <span class="built_in">len</span>(h), <span class="built_in">cap</span>(h)) <span class="comment">// [0 1 4 5] 4 6</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><ul>
<li>映射（map）像 slice 一样，也有底层数据结构<ul>
<li>map 的赋值并不会拷贝底层数据结构，它们都指向同一段内存</li>
</ul>
</li>
<li>映射（map）是无序的，key 必须支持比较操作（<code>==</code>和<code>!=</code>）<ul>
<li>key 不能是 function、map 和 slice 类型</li>
<li>key 是 interface 时，其运行时的动态类型必须支持比较操作（否则会出现执行错误）</li>
<li>访问 key 不存在的元素将返回 zero 值</li>
<li>映射的初始大小不会限制其容量，其容量会增长以容纳更多元素</li>
</ul>
</li>
</ul>
<div class="tabs" id="go-type-map"><ul class="nav-tabs"><li class="tab active"><a href="#go-type-map-1">Basic</a></li></ul><div class="tab-content"><div class="tab-pane active" id="go-type-map-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> timeZone = <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>&#123;</span><br><span class="line">    <span class="string">&quot;UTC&quot;</span>:  <span class="number">0</span>*<span class="number">60</span>*<span class="number">60</span>,</span><br><span class="line">    <span class="string">&quot;EST&quot;</span>: <span class="number">-5</span>*<span class="number">60</span>*<span class="number">60</span>,</span><br><span class="line">    <span class="string">&quot;CST&quot;</span>: <span class="number">-6</span>*<span class="number">60</span>*<span class="number">60</span>,</span><br><span class="line">    <span class="string">&quot;MST&quot;</span>: <span class="number">-7</span>*<span class="number">60</span>*<span class="number">60</span>,</span><br><span class="line">    <span class="string">&quot;PST&quot;</span>: <span class="number">-8</span>*<span class="number">60</span>*<span class="number">60</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// declare</span></span><br><span class="line">    <span class="keyword">var</span> m <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    m = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// add &amp; modify</span></span><br><span class="line">    m[<span class="string">&quot;a&quot;</span>] = <span class="number">1</span></span><br><span class="line">    m[<span class="string">&quot;b&quot;</span>] = <span class="number">2</span></span><br><span class="line">    m[<span class="string">&quot;c&quot;</span>] = <span class="number">3</span></span><br><span class="line">    fmt.Println(m) <span class="comment">// map[a:1 b:2 c:3]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// delete</span></span><br><span class="line">    <span class="built_in">delete</span>(m, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    fmt.Println(m) <span class="comment">// map[b:2 c:3]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// query</span></span><br><span class="line">    v := m[<span class="string">&quot;b&quot;</span>]</span><br><span class="line">    fmt.Println(v) <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// exist?</span></span><br><span class="line">    v, ok := m[<span class="string">&quot;c&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> ok &#123;</span><br><span class="line">        fmt.Println(v, ok) <span class="comment">// 3 true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// traveral</span></span><br><span class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> m &#123;</span><br><span class="line">        fmt.Println(k, v) <span class="comment">// c 3  b 2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>

<h4 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h4><ul>
<li>将 map 的值类型定义为<code>struct&#123;&#125;</code>，其值即不占用内存空间</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// empty structures do not take up any memory space</span></span><br><span class="line"><span class="keyword">type</span> Set <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Set)</span></span> Add(key <span class="type">string</span>) &#123;</span><br><span class="line">    s[key] = <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Set)</span></span> Contains(key <span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">    _, ok := s[key]</span><br><span class="line">    <span class="keyword">return</span> ok</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    set := <span class="built_in">make</span>(Set)</span><br><span class="line">    set.Add(<span class="string">&quot;A&quot;</span>)</span><br><span class="line">    set.Add(<span class="string">&quot;B&quot;</span>)</span><br><span class="line"></span><br><span class="line">    fmt.Println(set.Contains(<span class="string">&quot;A&quot;</span>)) <span class="comment">// true</span></span><br><span class="line">    fmt.Println(set.Contains(<span class="string">&quot;C&quot;</span>)) <span class="comment">// false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Struct"><a href="#Struct" class="headerlink" title="Struct"></a>Struct</h3><ul>
<li>结构体（struct）是一系列命名字段（field）的序列<ul>
<li>支持匿名字段（anonymous field）：只有 field 类型，此时 field 的类型也作为名字使用</li>
<li>支持空字段（empty field）：field 的名字为<code>_</code>，用于忽略掉某些不需要的字段以提高性能<ul>
<li>多个空字段之间没有区分，因此无法区分它们</li>
</ul>
</li>
<li>支持嵌入字段（embedded field）：将结构体类型 A 嵌入结构体类型 B 中，从而复用 A 的所有 field</li>
<li>支持对字段添加字面量标签（literal tag）：是编译时的字符串注释，其中包含一些键值对（可用空格或逗号分隔）</li>
</ul>
</li>
<li>空结构体（<code>struct&#123;&#125;</code>）：不占用内存空间，仅作为占位符使用<ul>
<li>将 map 的值类型定义为空结构体，可以将 map 作为 set 使用</li>
<li>定义只包含方法的结构体，只有默认实现</li>
</ul>
</li>
</ul>
<div class="tabs" id="go-struct"><ul class="nav-tabs"><li class="tab active"><a href="#go-struct-1">Basic</a></li><li class="tab"><a href="#go-struct-2">TagForJson</a></li></ul><div class="tab-content"><div class="tab-pane active" id="go-struct-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</span><br><span class="line">    x <span class="type">int</span></span><br><span class="line">    y <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> AA <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="type">int</span>    <span class="comment">// (empty field)</span></span><br><span class="line">    <span class="type">string</span> <span class="comment">// (empty field)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> B <span class="keyword">struct</span> &#123;</span><br><span class="line">    z <span class="type">float32</span></span><br><span class="line">    A <span class="comment">// (embedded field)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> BB <span class="keyword">struct</span> &#123;</span><br><span class="line">    z  <span class="type">float32</span></span><br><span class="line">    a  A</span><br><span class="line">    _  <span class="type">int</span> <span class="comment">// padding (anonymous field)</span></span><br><span class="line">    aa AA</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(unsafe.Sizeof(<span class="keyword">struct</span>&#123;&#125;&#123;&#125;)) <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">    a := A&#123;x: <span class="number">1</span>, y: <span class="string">&quot;2&quot;</span>&#125;</span><br><span class="line">    fmt.Println(a.x, a.y) <span class="comment">// 1 2</span></span><br><span class="line"></span><br><span class="line">    b := B&#123;A: A&#123;x: <span class="number">1</span>, y: <span class="string">&quot;2&quot;</span>&#125;, z: <span class="number">3.0</span>&#125;</span><br><span class="line">    fmt.Println(b.x, b.y, b.z) <span class="comment">// 1 2 3</span></span><br><span class="line"></span><br><span class="line">    bb := BB&#123;a: A&#123;x: <span class="number">1</span>, y: <span class="string">&quot;2&quot;</span>&#125;, aa: AA&#123;<span class="number">11</span>, <span class="string">&quot;22&quot;</span>&#125;, z: <span class="number">3.0</span>&#125;</span><br><span class="line">    fmt.Println(bb.a.x, bb.a.y, bb.aa.<span class="type">int</span>, bb.aa.<span class="type">string</span>, bb.z) <span class="comment">// 1 2 11 22 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-struct-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="type">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">    Age  <span class="type">int</span>    <span class="string">`json:&quot;age&quot;`</span></span><br><span class="line">    City <span class="type">string</span> <span class="string">`json:&quot;city,omitempty&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    p := Person&#123;Name: <span class="string">&quot;Alice&quot;</span>, Age: <span class="number">30</span>, City: <span class="string">&quot;&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将Person实例序列化为JSON格式</span></span><br><span class="line">    b, err := json.Marshal(p)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输出序列化后的JSON字符串</span></span><br><span class="line">    fmt.Println(<span class="type">string</span>(b)) <span class="comment">// &#123;&quot;name&quot;:&quot;Alice&quot;,&quot;age&quot;:30&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>

<h4 id="Align"><a href="#Align" class="headerlink" title="Align"></a>Align</h4><ul>
<li>CPU 按字长为单位访问内存，比如 32 位 cpu，字长为 4byte<ul>
<li>按字长访问减少了 CPU 访问内存的次数，从而加大了 CPU 访问内存的吞吐量</li>
</ul>
</li>
<li>结构体对齐原因：<ul>
<li>对于多字节大小的值，比如原本可以存储在一个字长上，由于未对齐内存，可能会占据前后两个字长，从而增加 CPU 访问内存的次数</li>
<li>每次内存访问是原子操作，因此如果变量大小不超过字长，内存对齐后，对该变量的访问就是原子的</li>
</ul>
</li>
<li>GO 对齐规则：<ul>
<li>对于任意类型的变量 x ，unsafe.Alignof(x) 至少为 1</li>
<li>对于 struct 类型的变量 x，计算每一个字段 f 的 unsafe.Alignof(x.f)后，取其中的最大值</li>
<li>对于 array 数组类型的变量 x，unsafe.Alignof(x) 等于构成数组的元素类型的对齐倍数</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;unsafe&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 空结构体大小为0</span></span><br><span class="line"><span class="keyword">type</span> Empty <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 空结构体作为其他struct最后一个字段时，需要填充额外的内存保证安全</span></span><br><span class="line"><span class="comment">// (因为如果有指针指向该字段, 返回的地址将在结构体之外)</span></span><br><span class="line"><span class="keyword">type</span> S1 <span class="keyword">struct</span> &#123;</span><br><span class="line">    a <span class="type">int32</span></span><br><span class="line">    Empty</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> S2 <span class="keyword">struct</span> &#123;</span><br><span class="line">    Empty</span><br><span class="line">    a <span class="type">int32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在x64位机器上，一个 int 占 8 字节</span></span><br><span class="line"><span class="keyword">type</span> S3 <span class="keyword">struct</span> &#123;</span><br><span class="line">    a <span class="type">int</span></span><br><span class="line">    b <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> S4 <span class="keyword">struct</span> &#123;</span><br><span class="line">    a <span class="type">int8</span></span><br><span class="line">    b <span class="type">int16</span></span><br><span class="line">    c <span class="type">int32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> S5 <span class="keyword">struct</span> &#123;</span><br><span class="line">    a <span class="type">int8</span></span><br><span class="line">    c <span class="type">int32</span></span><br><span class="line">    b <span class="type">int16</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    x := Empty&#123;&#125;</span><br><span class="line">    s1 := S1&#123;&#125;</span><br><span class="line">    s2 := S2&#123;&#125;</span><br><span class="line">    s3 := S3&#123;&#125;</span><br><span class="line">    s4 := S4&#123;&#125;</span><br><span class="line">    s5 := S5&#123;&#125;</span><br><span class="line">    fmt.Println(unsafe.Alignof(x), unsafe.Sizeof(x))   <span class="comment">// 1 0</span></span><br><span class="line">    fmt.Println(unsafe.Alignof(s1), unsafe.Sizeof(s1)) <span class="comment">// 4 8</span></span><br><span class="line">    fmt.Println(unsafe.Alignof(s2), unsafe.Sizeof(s2)) <span class="comment">// 4 4</span></span><br><span class="line">    fmt.Println(unsafe.Alignof(s3), unsafe.Sizeof(s3)) <span class="comment">// 8 16</span></span><br><span class="line">    fmt.Println(unsafe.Alignof(s4), unsafe.Sizeof(s4)) <span class="comment">// 4 8</span></span><br><span class="line">    fmt.Println(unsafe.Alignof(s5), unsafe.Sizeof(s5)) <span class="comment">// 4 12</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Pointer"><a href="#Pointer" class="headerlink" title="Pointer"></a>Pointer</h3><ul>
<li>指针（pointer）用于存储变量的内存地址</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</span><br><span class="line">    x, y <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *A)</span></span> setX(x <span class="type">int</span>) &#123;</span><br><span class="line">    p.x = x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">incr</span><span class="params">(p *<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    *p++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createInt</span><span class="params">()</span></span> *<span class="type">int</span> &#123;</span><br><span class="line">    x := <span class="number">123</span></span><br><span class="line">    <span class="keyword">return</span> &amp;x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// point to int</span></span><br><span class="line">    <span class="keyword">var</span> p *<span class="type">int</span></span><br><span class="line">    x := <span class="number">10</span></span><br><span class="line">    p = &amp;x</span><br><span class="line">    fmt.Println(x, *p, p) <span class="comment">// 10 10 0xc00001c150</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// as parameter</span></span><br><span class="line">    incr(p)</span><br><span class="line">    fmt.Println(x, *p, p) <span class="comment">// 11 11 0xc00001c150</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// point to struct</span></span><br><span class="line">    p2 := <span class="built_in">new</span>(A)</span><br><span class="line">    p2.x = <span class="number">1</span></span><br><span class="line">    p2.y = <span class="number">2</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%d %T\n&quot;</span>, *p2, p2) <span class="comment">// &#123;1 2&#125; *main.A</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// as receiver</span></span><br><span class="line">    p2.setX(<span class="number">11</span>)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%d %T\n&quot;</span>, *p2, p2) <span class="comment">// &#123;11 2&#125; *main.A</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// as return value</span></span><br><span class="line">    p3 := createInt()</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%d %T\n&quot;</span>, *p3, p3) <span class="comment">// 123 *int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h3><ul>
<li>函数（function）是一等公民（first-class citizens），与基本类型支持的场景是等价的</li>
<li>函数支持多个返回值<ul>
<li>函数的命名返回参数可以用作输入参数，当 return 后无参数时，默认返回命名参数的当前值</li>
</ul>
</li>
<li>函数传参：<ul>
<li>按值传递：会拷贝整个对象<ul>
<li>用于只读的占用内存较小的结构体</li>
</ul>
</li>
<li>按指针传递：只会拷贝指针地址，指向的对象是同一个，但会导致内存分配逃逸到堆中，增加GC负担<ul>
<li>用于需要修改原对象值</li>
<li>用于占用内存比较大的结构体</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="tabs" id="go-function"><ul class="nav-tabs"><li class="tab active"><a href="#go-function-1">Basic</a></li><li class="tab"><a href="#go-function-2">SpecialParam</a></li><li class="tab"><a href="#go-function-3">MultiReturnValue</a></li><li class="tab"><a href="#go-function-4">NamedReturnParameter</a></li></ul><div class="tab-content"><div class="tab-pane active" id="go-function-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> AddFunc <span class="function"><span class="keyword">func</span><span class="params">(x, y <span class="type">int</span>)</span></span> <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x, y <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeAdder</span><span class="params">(x <span class="type">int</span>)</span></span> <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(y <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x + y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// functional type</span></span><br><span class="line">    <span class="keyword">var</span> f AddFunc = add</span><br><span class="line">    r := f(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    fmt.Println(r) <span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// anonymous function</span></span><br><span class="line">    f2 := <span class="function"><span class="keyword">func</span><span class="params">(x, y <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x + y</span><br><span class="line">    &#125;</span><br><span class="line">    r2 := f2(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    fmt.Println(r2) <span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// closure</span></span><br><span class="line">    add2 := makeAdder(<span class="number">2</span>)</span><br><span class="line">    add5 := makeAdder(<span class="number">5</span>)</span><br><span class="line">    r3 := add2(<span class="number">3</span>)</span><br><span class="line">    r4 := add5(<span class="number">3</span>)</span><br><span class="line">    fmt.Println(r3, r4) <span class="comment">// 5 8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-function-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x <span class="type">int</span>, _ <span class="type">int</span>, y <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">print</span><span class="params">(prefix <span class="type">string</span>, values ...<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    fmt.Print(prefix)</span><br><span class="line">    <span class="keyword">for</span> _, value := <span class="keyword">range</span> values &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%d &quot;</span>, value)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// anonymous variable (ignore)</span></span><br><span class="line">    r := add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    fmt.Println(r) <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// variadic</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;: &quot;</span>)       <span class="comment">// :</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;: &quot;</span>, <span class="number">1</span>)    <span class="comment">// : 1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;: &quot;</span>, <span class="number">1</span>, <span class="number">2</span>) <span class="comment">// : 1 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-function-3"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;unicode&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回多个参数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">nextInt</span><span class="params">(b []<span class="type">byte</span>, i <span class="type">int</span>)</span></span> (<span class="type">int</span>, <span class="type">int</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> ; i &lt; <span class="built_in">len</span>(b) &amp;&amp; !unicode.IsDigit(<span class="type">rune</span>(b[i])); i++ &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    x := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ; i &lt; <span class="built_in">len</span>(b) &amp;&amp; unicode.IsDigit(<span class="type">rune</span>(b[i])); i++ &#123;</span><br><span class="line">        x = x*<span class="number">10</span> + <span class="type">int</span>(b[i]) - <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> x, i</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    b := []<span class="type">byte</span>&#123;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>&#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(b); &#123;</span><br><span class="line">        <span class="keyword">var</span> x <span class="type">int</span></span><br><span class="line">        x, i = nextInt(b, i)</span><br><span class="line">        fmt.Println(x)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-function-4"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// n和err用作输入参数，return返回n和err的当前值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReadFull</span><span class="params">(r Reader, buf []<span class="type">byte</span>)</span></span> (n <span class="type">int</span>, err <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">len</span>(buf) &gt; <span class="number">0</span> &amp;&amp; err == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> nr <span class="type">int</span></span><br><span class="line">        nr, err = r.Read(buf)</span><br><span class="line">        n += nr</span><br><span class="line">        buf = buf[nr:]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>

<h4 id="不定长参数（variadic）"><a href="#不定长参数（variadic）" class="headerlink" title="不定长参数（variadic）"></a>不定长参数（variadic）</h4><ul>
<li>不定长参数函数（variadic function）可以接受任意数量的参数（用<code>...</code>表示）</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sum</span><span class="params">(nums ...<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    sum := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">        sum += num</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(Sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>))       <span class="comment">// 6</span></span><br><span class="line">    fmt.Println(Sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)) <span class="comment">// 15</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="延迟调用（defer）"><a href="#延迟调用（defer）" class="headerlink" title="延迟调用（defer）"></a>延迟调用（defer）</h4><ul>
<li><code>defer</code>前缀可以将函数延迟到 return 前调用，常用于<code>mutex.Unlock()</code>或<code>file.Close()</code>前面<ul>
<li>多次 defer 会缓存到 stack 结构中，直到 return 前按 LIFO 顺序执行</li>
<li>defer 可以使相互关联的代码写在一起，更简洁易懂</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Example_1</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printDefer</span><span class="params">()</span></span> &#123; <span class="comment">// SE2 1 0</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;S&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">defer</span> fmt.Printf(<span class="string">&quot;%d &quot;</span>, i) <span class="comment">// LIFO</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;E&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Example_2</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Contents</span><span class="params">(filename <span class="type">string</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">    f, err := os.Open(filename)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> f.Close()  <span class="comment">// f.Close will run when we&#x27;re finished.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result []<span class="type">byte</span></span><br><span class="line">    buf := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        n, err := f.Read(buf[<span class="number">0</span>:])</span><br><span class="line">        result = <span class="built_in">append</span>(result, buf[<span class="number">0</span>:n]...)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err  <span class="comment">// f will be closed if we return here.</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">string</span>(result), <span class="literal">nil</span> <span class="comment">// f will be closed if we return here.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Interface"><a href="#Interface" class="headerlink" title="Interface"></a>Interface</h3><ul>
<li>接口（interface）类型用于定义一个类型集（type set），但没有具体实现。<ul>
<li>方法（method）的名字必须是唯一的（unique），且不能是空白字符（not blank）</li>
<li>一个类型只要实现了接口中定义的所有方法，就可以赋值给该接口类型的变量（多态，隐式实现）</li>
<li>类型断言（type assertion, <code>r, ok = shape.(Rectangle)</code>）可以将一个接口类型的值转换为一个具体的类型</li>
</ul>
</li>
<li>接口分类：<ul>
<li>空接口（empty interface, <code>interface&#123;&#125;</code>）：类型集由所有非接口（non-interface）类型组成</li>
<li>基本接口（basic interface）：类型集完全由方法（method）组成</li>
<li>嵌套接口（embedded interface）：类型集中包含有其他的接口<ul>
<li>如果接口中出现了多个同名的方法，其声明必须是一致的</li>
</ul>
</li>
<li>泛型接口（general interface）：类型集中含有<code>~T</code>形式元素，其中<code>T</code>为非接口（non-interface）类型<ul>
<li>利用类型约束（type constraint）特性，限制一个接口类型只能被实现为某些特定的类型<ul>
<li><code>~int</code>限制为所有底层类型为 int 的类型</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="tabs" id="go-type-interface"><ul class="nav-tabs"><li class="tab active"><a href="#go-type-interface-1">EmptyInterface</a></li><li class="tab"><a href="#go-type-interface-2">EmbeddedInterface</a></li><li class="tab"><a href="#go-type-interface-3">GeneralInterface</a></li><li class="tab"><a href="#go-type-interface-4">Polymorphic</a></li></ul><div class="tab-content"><div class="tab-pane active" id="go-type-interface-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> any <span class="keyword">interface</span>&#123;&#125; <span class="comment">// (empty interface)</span></span><br><span class="line"></span><br><span class="line">    any = <span class="string">&quot;Hi&quot;</span></span><br><span class="line">    fmt.Println(any) <span class="comment">// Hi</span></span><br><span class="line"></span><br><span class="line">    any = <span class="number">123</span></span><br><span class="line">    fmt.Println(any) <span class="comment">// 123</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-type-interface-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">interface</span> &#123;</span><br><span class="line">    Name() <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Employee <span class="keyword">interface</span> &#123;</span><br><span class="line">    Person</span><br><span class="line">    Salary() <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Manager <span class="keyword">interface</span> &#123;</span><br><span class="line">    Employee</span><br><span class="line">    TeamSize() <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SalesManager <span class="keyword">struct</span> &#123;</span><br><span class="line">    name     <span class="type">string</span></span><br><span class="line">    salary   <span class="type">float64</span></span><br><span class="line">    teamSize <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s SalesManager)</span></span> Name() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> s.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s SalesManager)</span></span> Salary() <span class="type">float64</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> s.salary</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s SalesManager)</span></span> TeamSize() <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> s.teamSize</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> m Manager</span><br><span class="line">    m = SalesManager&#123;name: <span class="string">&quot;Alice&quot;</span>, salary: <span class="number">5000.0</span>, teamSize: <span class="number">10</span>&#125;</span><br><span class="line">    fmt.Println(m.Name())     <span class="comment">// Alice</span></span><br><span class="line">    fmt.Println(m.Salary())   <span class="comment">// 5000</span></span><br><span class="line">    fmt.Println(m.TeamSize()) <span class="comment">// 10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-type-interface-3"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Float <span class="keyword">interface</span> &#123;</span><br><span class="line">    ~<span class="type">float32</span> | ~<span class="type">float64</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-type-interface-4"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Define interface</span></span><br><span class="line"><span class="keyword">type</span> Shape <span class="keyword">interface</span> &#123;</span><br><span class="line">    Area() <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Define struct（implicit implement Shape）</span></span><br><span class="line"><span class="keyword">type</span> Rectangle <span class="keyword">struct</span> &#123;</span><br><span class="line">    Width  <span class="type">float64</span></span><br><span class="line">    Height <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r Rectangle)</span></span> Area() <span class="type">float64</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> r.Width * r.Height</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Define struct（implicit implement Shape）</span></span><br><span class="line"><span class="keyword">type</span> Circle <span class="keyword">struct</span> &#123;</span><br><span class="line">    Radius <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Circle)</span></span> Area() <span class="type">float64</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> math.Pi * c.Radius * c.Radius</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Interface as Parameter</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PrintArea</span><span class="params">(s Shape)</span></span> &#123;</span><br><span class="line">    fmt.Println(s.Area())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// polymorphic</span></span><br><span class="line">    r := Rectangle&#123;Width: <span class="number">3</span>, Height: <span class="number">4</span>&#125;</span><br><span class="line">    c := Circle&#123;Radius: <span class="number">5</span>&#125;</span><br><span class="line">    PrintArea(r) <span class="comment">// 12</span></span><br><span class="line">    PrintArea(c) <span class="comment">// 78.53981633974483</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// type assertion</span></span><br><span class="line">    <span class="keyword">var</span> s Shape</span><br><span class="line">    s = Rectangle&#123;Width: <span class="number">5</span>, Height: <span class="number">6</span>&#125;</span><br><span class="line">    <span class="keyword">if</span> r, ok := s.(Rectangle); ok &#123;</span><br><span class="line">        fmt.Println(r.Width, r.Height) <span class="comment">// 5 6</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>

<h3 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h3><ul>
<li>通道（channel）提供了一种在协程间通信数据的机制<ul>
<li>通道被关闭（<code>close()</code>）后，不能再 send 数据，但可 receive 数据（同时判断通道是否被关闭了）</li>
<li>通道的行为类似 FIFO 的队列（queue），receive 的顺序和 send 的顺序是一致的</li>
<li>select 语句可以同时等待多个 channel 的数据和事件<ul>
<li>每个 case 分支可以是 send、receive 或其他事件</li>
<li>如果多个 case 分支同时就绪，会随机选择其中一个分支执行</li>
<li>如果没有 case 分支就绪，会执行 default 分支或者阻塞等待</li>
</ul>
</li>
</ul>
</li>
<li>通道的声明：<ul>
<li><code>var ch chan&lt;- int</code> 声明只用于 send int 数据的通道</li>
<li><code>var ch &lt;-chan int</code> 声明只用于 receive int 数据的通道</li>
<li><code>var ch chan int</code> 声明可用于 send&amp;receive int 数据的通道</li>
</ul>
</li>
<li>通道的初始化：<ul>
<li><code>ch = make(chan int)</code> 创建一个用于 int 数据的 unbuffered 通道<ul>
<li>sender 会一直阻塞直到对应的值被 receiver 接收</li>
</ul>
</li>
<li><code>ch = make(chan int, 10)</code> 创建一个可缓存 10 个 int 数据的通道（类似 semaphore）<ul>
<li>sender 在 buffer 处于 full 状态时才会阻塞</li>
<li>receiver 在 buffer 处于 empty 状态时才会阻塞</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="tabs" id="go-type-channel"><ul class="nav-tabs"><li class="tab active"><a href="#go-type-channel-1">Basic</a></li><li class="tab"><a href="#go-type-channel-2">SelectMultiChannel</a></li></ul><div class="tab-content"><div class="tab-pane active" id="go-type-channel-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">producer</span><span class="params">(ch <span class="keyword">chan</span>&lt;- <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        ch &lt;- i</span><br><span class="line">        time.Sleep(time.Second)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(ch)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">consumer</span><span class="params">(ch &lt;-<span class="keyword">chan</span> <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="comment">// ok=true meaning ch not closed</span></span><br><span class="line">        value, ok := &lt;-ch</span><br><span class="line">        <span class="keyword">if</span> !ok &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        fmt.Println(value) <span class="comment">// 0  1  2  3  4</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> producer(ch)</span><br><span class="line">    <span class="keyword">go</span> consumer(ch)</span><br><span class="line"></span><br><span class="line">    time.Sleep(<span class="number">8</span> * time.Second)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-type-channel-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">producer</span><span class="params">(ch <span class="keyword">chan</span>&lt;- <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        ch &lt;- i</span><br><span class="line">        time.Sleep(time.Duration(i) * time.Second)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(ch)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">consumer</span><span class="params">(ch &lt;-<span class="keyword">chan</span> <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> value, ok := &lt;-ch:</span><br><span class="line">            <span class="keyword">if</span> !ok &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            fmt.Println(value)</span><br><span class="line">        <span class="keyword">case</span> &lt;-time.After(<span class="number">2</span> * time.Second):</span><br><span class="line">            fmt.Println(<span class="string">&quot;timeout&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> producer(ch)</span><br><span class="line">    <span class="keyword">go</span> consumer(ch)</span><br><span class="line"></span><br><span class="line">    time.Sleep(<span class="number">8</span> * time.Second)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*[OUTPUT]</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">timeout</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></div></div></div>

<h4 id="关闭通道"><a href="#关闭通道" class="headerlink" title="关闭通道"></a>关闭通道</h4><ul>
<li>通道关闭原则（推荐）：只应该让一个通道唯一的发送者关闭此通道<ul>
<li>通道只能在接收方检查是否已经关闭，且要等 close 前的数据已经消费完毕后才会检查到（依赖通道状态）</li>
<li>关闭一个已经关闭的通道将产生一个 panic ，因此 close 一个不知道是否已经关闭的通道是很危险的</li>
<li>向一个已关闭的通道 send 数据将产生一个 panic ，因此向一个不知道是否已经关闭的通道 send 数据是很危险的</li>
<li>Go 白皮书并不保证发生在一个通道上的并发关闭操作和发送操作不会产生数据竞争</li>
</ul>
</li>
</ul>
<div class="tabs" id="go-type-channel-close"><ul class="nav-tabs"><li class="tab active"><a href="#go-type-channel-close-1">Basic</a></li><li class="tab"><a href="#go-type-channel-close-2">MultiReceiver</a></li><li class="tab"><a href="#go-type-channel-close-3">MultiSender</a></li><li class="tab"><a href="#go-type-channel-close-4">MultiSenderAndReceiver</a></li></ul><div class="tab-content"><div class="tab-pane active" id="go-type-channel-close-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> dep_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;runtime&quot;</span></span><br><span class="line">    <span class="string">&quot;testing&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doThing</span><span class="params">(data <span class="keyword">chan</span> <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="comment">// ok=true表示数据是有效载荷，false在chan关闭后产生</span></span><br><span class="line">        <span class="comment">// chan已经关闭后，&lt;-ch 将不会阻塞</span></span><br><span class="line">        <span class="keyword">case</span> v, ok := &lt;-data:</span><br><span class="line">            <span class="keyword">if</span> !ok &#123;</span><br><span class="line">                fmt.Println(<span class="string">&quot;data has been closed&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            time.Sleep(time.Millisecond)</span><br><span class="line">            fmt.Printf(<span class="string">&quot;task %d is done\n&quot;</span>, v)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runExitByClose</span><span class="params">()</span></span> &#123;</span><br><span class="line">    data := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">go</span> doThing(data)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">        data &lt;- i</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestExitByClose</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    t.Log(runtime.NumGoroutine())</span><br><span class="line">    runExitByClose()</span><br><span class="line">    time.Sleep(time.Second)</span><br><span class="line">    runtime.GC()</span><br><span class="line">    t.Log(runtime.NumGoroutine())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-type-channel-close-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> dep_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;runtime&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">    <span class="string">&quot;testing&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runMultiReceiver</span><span class="params">()</span></span> &#123;</span><br><span class="line">    log.SetFlags(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    dataCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> Max = <span class="number">10000</span></span><br><span class="line">    sumSender := <span class="number">0</span></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">for</span> value := Max; ; value-- &#123;</span><br><span class="line">            <span class="keyword">if</span> value == <span class="number">0</span> &#123;</span><br><span class="line">                <span class="comment">// 唯一的发送者可以安全地关闭dataCh通道</span></span><br><span class="line">                <span class="built_in">close</span>(dataCh)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            dataCh &lt;- value</span><br><span class="line">            sumSender += value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> NumReceivers = <span class="number">10</span></span><br><span class="line">    sumReceiver := <span class="number">0</span></span><br><span class="line">    sumReceiveItems := <span class="built_in">make</span>([]<span class="type">int</span>, NumReceivers)</span><br><span class="line">    wgReceivers := sync.WaitGroup&#123;&#125;</span><br><span class="line">    wgReceivers.Add(NumReceivers)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; NumReceivers; i++ &#123;</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> wgReceivers.Done()</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 多个接收者互相竞争地接收数据，直到通道队列已空且被关闭</span></span><br><span class="line">            <span class="keyword">for</span> value := <span class="keyword">range</span> dataCh &#123;</span><br><span class="line">                sumReceiveItems[i] += value</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            sumReceiver += sumReceiveItems[i]</span><br><span class="line">        &#125;(i)</span><br><span class="line">    &#125;</span><br><span class="line">    wgReceivers.Wait()</span><br><span class="line">    log.Println(sumSender, sumReceiver, sumReceiveItems)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestRunMultiReceiver</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    t.Log(runtime.NumGoroutine())</span><br><span class="line">    runMultiReceiver()</span><br><span class="line">    t.Log(runtime.NumGoroutine())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-type-channel-close-3"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> dep_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;runtime&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">    <span class="string">&quot;testing&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runMultiSender</span><span class="params">()</span></span> &#123;</span><br><span class="line">    log.SetFlags(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> Max = <span class="number">1000</span></span><br><span class="line">    <span class="keyword">const</span> NumSenders = <span class="number">10</span></span><br><span class="line">    <span class="keyword">const</span> NumReceivers = <span class="number">1</span></span><br><span class="line">    wgMain := sync.WaitGroup&#123;&#125;</span><br><span class="line">    wgMain.Add(NumSenders + NumReceivers)</span><br><span class="line"></span><br><span class="line">    dataCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">    stopCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line">    sumSender := <span class="number">0</span></span><br><span class="line">    sumSendItems := <span class="built_in">make</span>([]<span class="type">int</span>, NumSenders)</span><br><span class="line">    wgSenders := sync.WaitGroup&#123;&#125;</span><br><span class="line">    wgSenders.Add(NumSenders)</span><br><span class="line">    <span class="keyword">for</span> i := NumSenders - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> wgMain.Done()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> j := Max; ; j-- &#123;</span><br><span class="line">                value := <span class="number">0</span></span><br><span class="line">                <span class="keyword">if</span> j == <span class="number">0</span> &#123;</span><br><span class="line">                    wgSenders.Done()</span><br><span class="line">                    wgSenders.Wait()</span><br><span class="line">                    sumSender += sumSendItems[i]</span><br><span class="line">                    log.Println(i, sumSendItems[i], sumSender)</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> j &gt; <span class="number">0</span> &#123;</span><br><span class="line">                    value = i*Max + j</span><br><span class="line">                    sumSendItems[i] += value</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">select</span> &#123;</span><br><span class="line">                <span class="keyword">case</span> &lt;-stopCh:</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">case</span> dataCh &lt;- value:</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;(i)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sumReceiver := <span class="number">0</span></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> wgMain.Done()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> value := <span class="keyword">range</span> dataCh &#123;</span><br><span class="line">            <span class="keyword">if</span> value == <span class="number">0</span> &#123;</span><br><span class="line">                <span class="comment">// 唯一的接收者可以安全地关闭stopCh通道</span></span><br><span class="line">                <span class="built_in">close</span>(stopCh)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            sumReceiver += value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    wgMain.Wait()</span><br><span class="line">    log.Println(sumSender, sumSendItems, sumReceiver)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestRunMultiSender</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    t.Log(runtime.NumGoroutine())</span><br><span class="line">    runMultiSender()</span><br><span class="line">    t.Log(runtime.NumGoroutine())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-type-channel-close-4"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> dep_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;runtime&quot;</span></span><br><span class="line">    <span class="string">&quot;strconv&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">    <span class="string">&quot;testing&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runMultiSenderAndReceiver</span><span class="params">()</span></span> &#123;</span><br><span class="line">    log.SetFlags(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> Max = <span class="number">1000</span></span><br><span class="line">    <span class="keyword">const</span> NumSenders = <span class="number">10</span></span><br><span class="line">    <span class="keyword">const</span> NumReceivers = <span class="number">10</span></span><br><span class="line">    <span class="keyword">const</span> NumAgents = <span class="number">1</span></span><br><span class="line">    wgMain := sync.WaitGroup&#123;&#125;</span><br><span class="line">    wgMain.Add(NumSenders + NumReceivers + NumAgents)</span><br><span class="line"></span><br><span class="line">    dataCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">    stopCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">    agentCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> stopper <span class="type">string</span></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> wgMain.Done()</span><br><span class="line"></span><br><span class="line">        stopper = &lt;-agentCh</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 唯一的调解者可以安全地关闭stopCh通道</span></span><br><span class="line">        <span class="built_in">close</span>(stopCh)</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    sumSender := <span class="number">0</span></span><br><span class="line">    sumSendItems := <span class="built_in">make</span>([]<span class="type">int</span>, NumSenders)</span><br><span class="line">    wgSenders := sync.WaitGroup&#123;&#125;</span><br><span class="line">    wgSenders.Add(NumSenders)</span><br><span class="line">    <span class="keyword">for</span> i := NumSenders - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> wgMain.Done()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> j := Max; ; j-- &#123;</span><br><span class="line">                value := <span class="number">0</span></span><br><span class="line">                <span class="keyword">if</span> j == <span class="number">0</span> &#123;</span><br><span class="line">                    wgSenders.Done()</span><br><span class="line">                    wgSenders.Wait()</span><br><span class="line">                    sumSender += sumSendItems[i]</span><br><span class="line">                    log.Println(i, sumSendItems[i], sumSender)</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 向中间调解者发送信号（非阻塞）</span></span><br><span class="line">                    <span class="keyword">select</span> &#123;</span><br><span class="line">                    <span class="keyword">case</span> agentCh &lt;- <span class="string">&quot;Sender#&quot;</span> + strconv.Itoa(i):</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> j &gt; <span class="number">0</span> &#123;</span><br><span class="line">                    value = i*Max + j</span><br><span class="line">                    sumSendItems[i] += value</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">select</span> &#123;</span><br><span class="line">                <span class="keyword">case</span> &lt;-stopCh:</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">case</span> dataCh &lt;- value:</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;(i)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sumReceiver := <span class="number">0</span></span><br><span class="line">    sumReceiveItems := <span class="built_in">make</span>([]<span class="type">int</span>, NumReceivers)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; NumReceivers; i++ &#123;</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> wgMain.Done()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> &#123;</span><br><span class="line">                <span class="keyword">select</span> &#123;</span><br><span class="line">                <span class="keyword">case</span> &lt;-stopCh:</span><br><span class="line">                    sumReceiver += sumReceiveItems[i]</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">case</span> value := &lt;-dataCh:</span><br><span class="line">                    <span class="keyword">if</span> value == <span class="number">0</span> &#123;</span><br><span class="line">                        <span class="comment">// 向中间调解者发送信号（非阻塞）</span></span><br><span class="line">                        <span class="keyword">select</span> &#123;</span><br><span class="line">                        <span class="keyword">case</span> agentCh &lt;- <span class="string">&quot;Receiver#&quot;</span> + strconv.Itoa(i):</span><br><span class="line">                        <span class="keyword">default</span>:</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        sumReceiveItems[i] += value</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;(i)</span><br><span class="line">    &#125;</span><br><span class="line">    wgMain.Wait()</span><br><span class="line">    log.Println(stopper, sumSender, sumSendItems, sumReceiver, sumReceiveItems)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestRunMultiSenderAndReceiver</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    t.Log(runtime.NumGoroutine())</span><br><span class="line">    runMultiSenderAndReceiver()</span><br><span class="line">    runtime.GC()</span><br><span class="line">    t.Log(runtime.NumGoroutine())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>

<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><h3 id="方法声明（method-declaration）"><a href="#方法声明（method-declaration）" class="headerlink" title="方法声明（method declaration）"></a>方法声明（method declaration）</h3><ul>
<li>类型扩展方法的两种形式：<ul>
<li>value 作为 receiver：<code>func (p Person) Value(name Person)</code><ul>
<li>只能读类型的值，不能改写它</li>
</ul>
</li>
<li>pointer 作为 receiver：<code>func (p *Person) Pointer(name Person)</code><ul>
<li>既能读类型的值，又能改写类型的值</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Point <span class="keyword">struct</span> &#123;</span><br><span class="line">    X, Y <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Point)</span></span> Distance() <span class="type">float64</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> math.Sqrt(p.X*p.X + p.Y*p.Y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Point)</span></span> Scale(factor <span class="type">float64</span>) &#123;</span><br><span class="line">    p.X = p.X * factor</span><br><span class="line">    p.Y = p.Y * factor</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    p0 := Point&#123;X: <span class="number">3</span>, Y: <span class="number">4</span>&#125;</span><br><span class="line">    p1 := &amp;p0</span><br><span class="line">    fmt.Println(p0.Distance(), p1.Distance()) <span class="comment">// 5 5</span></span><br><span class="line"></span><br><span class="line">    p2 := Point&#123;X: <span class="number">3</span>, Y: <span class="number">4</span>&#125;</span><br><span class="line">    p3 := &amp;p2</span><br><span class="line">    p2.Scale(<span class="number">2</span>)</span><br><span class="line">    fmt.Println(p2.X, p2.Y, p3.X, p3.Y) <span class="comment">// 6 8 6 8</span></span><br><span class="line">    p3.Scale(<span class="number">2</span>)</span><br><span class="line">    fmt.Println(p2.X, p2.Y, p3.X, p3.Y) <span class="comment">// 12 16 12 16</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="类型断言（type-assertion）"><a href="#类型断言（type-assertion）" class="headerlink" title="类型断言（type assertion）"></a>类型断言（type assertion）</h3><ul>
<li>类型断言（type assertion）提供了一种将 interface 类型转换为其他类型的方式</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> v := i.(<span class="keyword">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">int</span>:</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%T %v\n&quot;</span>, i, v) <span class="comment">// int 21</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">string</span>:</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%T %q\n&quot;</span>, i, v) <span class="comment">// string &quot;hello&quot;</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%T %v&quot;</span>, i, v) <span class="comment">// bool true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> i <span class="keyword">interface</span>&#123;&#125; = <span class="string">&quot;abc&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ToString</span></span><br><span class="line">    s := i.(<span class="type">string</span>)</span><br><span class="line">    fmt.Println(s) <span class="comment">// abc</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ToByteArray</span></span><br><span class="line">    b := []<span class="type">byte</span>(i.(<span class="type">string</span>))</span><br><span class="line">    fmt.Println(b) <span class="comment">// [97 98 99]</span></span><br><span class="line"></span><br><span class="line">    run(<span class="number">21</span>)</span><br><span class="line">    run(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">    run(<span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="内建函数（built-in-function）"><a href="#内建函数（built-in-function）" class="headerlink" title="内建函数（built-in function）"></a>内建函数（built-in function）</h1><h2 id="panic-amp-recover"><a href="#panic-amp-recover" class="headerlink" title="panic &amp; recover"></a>panic &amp; recover</h2><ul>
<li>panic 和 recover 函数提供了一种处理异常和错误的机制<ul>
<li>panic 函数用于引发运行时错误</li>
<li>recover 函数用于捕获并恢复 panic 引发的错误，从而使程序能够继续执行<ul>
<li>只能在 defer 语句中使用，并且只能捕获最后一个未处理的 panic 错误<ul>
<li>如果存在多个 defer 语句，且都包含了 recover 函数，则只有最后一个 defer 语句会捕获 panic 错误</li>
</ul>
</li>
<li>如果 recover 函数在没有发生 panic 错误的情况下调用，则会返回<code>nil</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">recoverFromPanic</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> r := <span class="built_in">recover</span>(); r != <span class="literal">nil</span> &#123; <span class="comment">// (catch run-time error)</span></span><br><span class="line">        fmt.Println(<span class="string">&quot;recover:&quot;</span>, r)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;recover:&quot;</span>, r)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> recoverFromPanic()</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;start&quot;</span>)</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">&quot;wrong&quot;</span>)     <span class="comment">// (raise run-time error)</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;end&quot;</span>) <span class="comment">// (unreachable code)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*[OUTPUT]</span></span><br><span class="line"><span class="comment">start</span></span><br><span class="line"><span class="comment">recover: wrong</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h1 id="控制结构（control-structure）"><a href="#控制结构（control-structure）" class="headerlink" title="控制结构（control structure）"></a>控制结构（control structure）</h1><h2 id="if"><a href="#if" class="headerlink" title="if"></a>if</h2><ul>
<li>支持可选的初始化语句（类似 for）</li>
</ul>
<div class="tabs" id="cs-if"><ul class="nav-tabs"><li class="tab active"><a href="#cs-if-1">if</a></li><li class="tab"><a href="#cs-if-2">if-else</a></li></ul><div class="tab-content"><div class="tab-pane active" id="cs-if-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// general</span></span><br><span class="line"><span class="keyword">if</span> x &gt; <span class="number">0</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="cs-if-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">num := <span class="number">10</span></span><br><span class="line"><span class="keyword">if</span> num%<span class="number">2</span> == <span class="number">0</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Even&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> num%<span class="number">3</span> == <span class="number">0</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Divisible by 3&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Odd&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// with initialization statement</span></span><br><span class="line"><span class="keyword">if</span> num := <span class="number">10</span>; num % <span class="number">2</span> == <span class="number">0</span> &#123;</span><br><span class="line">    fmt.Println(num, <span class="string">&quot;even&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Println(num, <span class="string">&quot;odd&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>

<h2 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h2><ul>
<li>支持可选的初始化语句（类似 for）</li>
<li><code>switch &#123;&#125;</code>语法等同<code>switch true &#123;&#125;</code>，可用于代替复杂的 if-else 语法</li>
<li><code>v.(type)</code>语法可用于发现 interface 变量的动态类型</li>
</ul>
<div class="tabs" id="cs-switch"><ul class="nav-tabs"><li class="tab active"><a href="#cs-switch-1">General</a></li><li class="tab"><a href="#cs-switch-2">InitStatement</a></li><li class="tab"><a href="#cs-switch-3">TypeSwitch</a></li></ul><div class="tab-content"><div class="tab-pane active" id="cs-switch-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Multiple values in a case</span></span><br><span class="line">num := <span class="number">2</span></span><br><span class="line"><span class="keyword">switch</span> num &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>:</span><br><span class="line">    fmt.Println(<span class="string">&quot;One, Four, or Seven&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>, <span class="number">5</span>, <span class="number">8</span>:</span><br><span class="line">    fmt.Println(<span class="string">&quot;Two, Five, or Eight&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    fmt.Println(<span class="string">&quot;Unknown&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Expression in switch</span></span><br><span class="line">x, y := <span class="number">3</span>, <span class="number">4</span></span><br><span class="line"><span class="keyword">switch</span> x * y &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">12</span>:</span><br><span class="line">    fmt.Println(<span class="string">&quot;Product is 12&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">15</span>:</span><br><span class="line">    fmt.Println(<span class="string">&quot;Product is 15&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    fmt.Println(<span class="string">&quot;Unknown product&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// No expression in switch (replacing complex if-else chain)</span></span><br><span class="line">num := <span class="number">5</span></span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line"><span class="keyword">case</span> num &lt; <span class="number">5</span>:</span><br><span class="line">    fmt.Println(<span class="string">&quot;Less than 5&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> num == <span class="number">5</span>:</span><br><span class="line">    fmt.Println(<span class="string">&quot;Equal to 5&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> num &gt; <span class="number">5</span>:</span><br><span class="line">    fmt.Println(<span class="string">&quot;Greater than 5&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="cs-switch-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> x := <span class="number">2</span> + <span class="number">3</span>; x &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>:</span><br><span class="line">    fmt.Println(<span class="string">&quot;x is less than or equal to 3&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">    fmt.Println(<span class="string">&quot;x is 4&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    fmt.Println(<span class="string">&quot;x is greater than 4&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="cs-switch-3"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printType</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> t := v.(<span class="keyword">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">int</span>:</span><br><span class="line">        fmt.Printf(<span class="string">&quot;Integer: %d\n&quot;</span>, t)</span><br><span class="line">    <span class="keyword">case</span> <span class="type">string</span>:</span><br><span class="line">        fmt.Printf(<span class="string">&quot;String: %s\n&quot;</span>, t)</span><br><span class="line">    <span class="keyword">case</span> <span class="type">float64</span>:</span><br><span class="line">        fmt.Printf(<span class="string">&quot;Float64: %f\n&quot;</span>, t)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        fmt.Printf(<span class="string">&quot;Unknown type: %T\n&quot;</span>, t)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    printType(<span class="number">42</span>)</span><br><span class="line">    printType(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">    printType(<span class="number">3.14</span>)</span><br><span class="line">    printType(<span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>

<h2 id="for"><a href="#for" class="headerlink" title="for"></a>for</h2><ul>
<li>循环只支持<code>for</code>，不支持<code>do-while</code></li>
</ul>
<div class="tabs" id="cs-for"><ul class="nav-tabs"><li class="tab active"><a href="#cs-for-1">General</a></li><li class="tab"><a href="#cs-for-2">InfiniteLoop</a></li></ul><div class="tab-content"><div class="tab-pane active" id="cs-for-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Like C for</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">    fmt.Println(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> i, j := <span class="number">0</span>, <span class="built_in">len</span>(a)<span class="number">-1</span>; i &lt; j; i, j = i+<span class="number">1</span>, j<span class="number">-1</span> &#123;</span><br><span class="line">    a[i], a[j] = a[j], a[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Like C while</span></span><br><span class="line">i := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i &lt; <span class="number">10</span> &#123;</span><br><span class="line">    fmt.Println(i)</span><br><span class="line">    i++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="cs-for-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Like C for(;;)</span></span><br><span class="line"><span class="keyword">for</span> <span class="literal">true</span> &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> &#123;&#125;</span><br></pre></td></tr></table></figure></div></div></div>

<h3 id="range"><a href="#range" class="headerlink" title="range"></a>range</h3><ul>
<li>range 可以用来遍历 array、slice、map 和 chan<ul>
<li>只迭代下标时，性能和普通 for 循环没有区别</li>
<li>迭代元素时，会创建元素的拷贝，当元素内存占用高时性能明显劣化<ul>
<li>将元素改为指针，可以避免迭代性能的劣化，且可以直接修改指针指向元素的值</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="tabs" id="go-for-range"><ul class="nav-tabs"><li class="tab active"><a href="#go-for-range-1">Basic</a></li><li class="tab"><a href="#go-for-range-2">Pointer</a></li></ul><div class="tab-content"><div class="tab-pane active" id="go-for-range-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// Slice</span></span><br><span class="line">    ws := []<span class="type">string</span>&#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> ws &#123; <span class="comment">// 只迭代index（与for循环性能一致）</span></span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">1</span> &#123;</span><br><span class="line">            <span class="comment">// 循环中修改切片，不在当前循环生效</span></span><br><span class="line">            ws = <span class="built_in">append</span>(ws, <span class="string">&quot;d&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        fmt.Println(i, ws[i]) <span class="comment">// 0 a  1 b  2 c</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> i, w := <span class="keyword">range</span> ws &#123; <span class="comment">// 迭代index和value</span></span><br><span class="line">        fmt.Println(i, w) <span class="comment">// 0 a  1 b  2 c  3 d</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Map</span></span><br><span class="line">    m := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>&#123;</span><br><span class="line">        <span class="string">&quot;a&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;b&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;c&quot;</span>: <span class="number">3</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> m &#123;</span><br><span class="line">        <span class="built_in">delete</span>(m, <span class="string">&quot;b&quot;</span>)               <span class="comment">// 迭代过程中，删除还未迭代到的键值对（b和c），则该键值对不会被迭代</span></span><br><span class="line">        m[<span class="string">&quot;d&quot;</span>] = <span class="number">4</span>                   <span class="comment">// 迭代过程中，新创建的键值对，不一定会被迭代</span></span><br><span class="line">        fmt.Printf(<span class="string">&quot;%v: %v\n&quot;</span>, k, v) <span class="comment">// a 1  d 4  c 3</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Chan</span></span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        ch &lt;- <span class="string">&quot;a&quot;</span></span><br><span class="line">        ch &lt;- <span class="string">&quot;b&quot;</span></span><br><span class="line">        ch &lt;- <span class="string">&quot;c&quot;</span></span><br><span class="line">        <span class="built_in">close</span>(ch)</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">for</span> s := <span class="keyword">range</span> ch &#123;</span><br><span class="line">        fmt.Println(s) <span class="comment">// a  b  c</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-for-range-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// ForValue</span></span><br><span class="line">    ts := []<span class="keyword">struct</span>&#123; id <span class="type">int</span> &#125;&#123;&#123;id: <span class="number">1</span>&#125;, &#123;id: <span class="number">2</span>&#125;, &#123;id: <span class="number">3</span>&#125;&#125;</span><br><span class="line">    <span class="keyword">for</span> _, s := <span class="keyword">range</span> ts &#123;</span><br><span class="line">        s.id += <span class="number">10</span> <span class="comment">// range对每个迭代值都创建了一个拷贝</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(ts); i++ &#123;</span><br><span class="line">        ts[i].id += <span class="number">100</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(ts) <span class="comment">// [&#123;101&#125; &#123;102&#125; &#123;103&#125;]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ForPointer</span></span><br><span class="line">    ps := []*<span class="keyword">struct</span>&#123; id <span class="type">int</span> &#125;&#123;&#123;id: <span class="number">1</span>&#125;, &#123;id: <span class="number">2</span>&#125;, &#123;id: <span class="number">3</span>&#125;&#125;</span><br><span class="line">    <span class="keyword">for</span> _, s := <span class="keyword">range</span> ps &#123;</span><br><span class="line">        s.id += <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(ps); i++ &#123;</span><br><span class="line">        ps[i].id += <span class="number">100</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(ps[<span class="number">0</span>], ps[<span class="number">1</span>], ps[<span class="number">2</span>]) <span class="comment">// &amp;&#123;111&#125; &amp;&#123;112&#125; &amp;&#123;113&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>

<h2 id="select"><a href="#select" class="headerlink" title="select"></a>select</h2><ul>
<li>select 语句用于同时等待多个 channel 的数据和事件<ul>
<li>每个 case 分支可以是 send、receive 或其他事件</li>
<li>如果多个 case 分支同时就绪，会随机选择其中一个分支执行</li>
<li>如果没有 case 分支就绪，会执行 default 分支或者阻塞等待</li>
</ul>
</li>
</ul>
<div class="tabs" id="go-select"><ul class="nav-tabs"><li class="tab active"><a href="#go-select-1">ReceiveMultiChannel</a></li><li class="tab"><a href="#go-select-2">SendToBufferedChan</a></li></ul><div class="tab-content"><div class="tab-pane active" id="go-select-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">producer</span><span class="params">(ch <span class="keyword">chan</span>&lt;- <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ &#123;</span><br><span class="line">        ch &lt;- i</span><br><span class="line">        time.Sleep(time.Second)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(ch)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">    ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> producer(ch1)</span><br><span class="line">    <span class="keyword">go</span> producer(ch2)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="comment">// blocking until ch1 &amp; ch2 occur received event</span></span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> value, ok := &lt;-ch1:</span><br><span class="line">            <span class="keyword">if</span> !ok &#123;</span><br><span class="line">                fmt.Println(<span class="string">&quot;ch1 closed&quot;</span>)</span><br><span class="line">                ch1 = <span class="literal">nil</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">            fmt.Println(<span class="string">&quot;ch1:&quot;</span>, value)</span><br><span class="line">        <span class="keyword">case</span> value, ok := &lt;-ch2:</span><br><span class="line">            <span class="keyword">if</span> !ok &#123;</span><br><span class="line">                fmt.Println(<span class="string">&quot;ch2 closed&quot;</span>)</span><br><span class="line">                ch2 = <span class="literal">nil</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">            fmt.Println(<span class="string">&quot;ch2:&quot;</span>, value)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ch1 == <span class="literal">nil</span> &amp;&amp; ch2 == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*[OUTPUT]</span></span><br><span class="line"><span class="comment">ch2: 0</span></span><br><span class="line"><span class="comment">ch1: 0</span></span><br><span class="line"><span class="comment">ch1: 1</span></span><br><span class="line"><span class="comment">ch2: 1</span></span><br><span class="line"><span class="comment">ch2: 2</span></span><br><span class="line"><span class="comment">ch1: 2</span></span><br><span class="line"><span class="comment">ch1 closed</span></span><br><span class="line"><span class="comment">ch2 closed</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-select-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">consumer</span><span class="params">(ch &lt;-<span class="keyword">chan</span> <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> value := <span class="keyword">range</span> ch &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;consumer:&quot;</span>, value)</span><br><span class="line">        time.Sleep(time.Second)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> consumer(ch)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> ch &lt;- i:</span><br><span class="line">            fmt.Println(<span class="string">&quot;producer:&quot;</span>, i)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            fmt.Println(<span class="string">&quot;channel is full&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">close</span>(ch)</span><br><span class="line"></span><br><span class="line">    time.Sleep(time.Second * <span class="number">8</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*[OUTPUT]</span></span><br><span class="line"><span class="comment">producer: 0</span></span><br><span class="line"><span class="comment">producer: 1</span></span><br><span class="line"><span class="comment">producer: 2</span></span><br><span class="line"><span class="comment">channel is full</span></span><br><span class="line"><span class="comment">channel is full</span></span><br><span class="line"><span class="comment">consumer: 0</span></span><br><span class="line"><span class="comment">consumer: 1</span></span><br><span class="line"><span class="comment">consumer: 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></div></div></div>

<h2 id="break"><a href="#break" class="headerlink" title="break"></a>break</h2><ul>
<li>可用于中断 for、switch 和 select 流程</li>
<li>支持可选的 label 标识跳出的第几层循环</li>
</ul>
<div class="tabs" id="cs-break"><ul class="nav-tabs"><li class="tab active"><a href="#cs-break-1">General</a></li><li class="tab"><a href="#cs-break-2">WithLabel</a></li></ul><div class="tab-content"><div class="tab-pane active" id="cs-break-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">5</span> &#123;</span><br><span class="line">        <span class="keyword">break</span> <span class="comment">// terminates the loop</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// switch</span></span><br><span class="line"><span class="keyword">switch</span> day := <span class="string">&quot;Monday&quot;</span>; day &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;Monday&quot;</span>:</span><br><span class="line">    fmt.Println(<span class="string">&quot;Today is Monday.&quot;</span>)</span><br><span class="line">    <span class="keyword">break</span> <span class="comment">// terminates the switch statement</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;Tuesday&quot;</span>:</span><br><span class="line">    fmt.Println(<span class="string">&quot;Today is Tuesday.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// select</span></span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> &lt;-ch:</span><br><span class="line">    fmt.Println(<span class="string">&quot;Received a value from channel.&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> &lt;-time.After(time.Second):</span><br><span class="line">    fmt.Println(<span class="string">&quot;Timeout.&quot;</span>)</span><br><span class="line">    <span class="keyword">break</span> <span class="comment">// terminates the select statement</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="cs-break-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    outerLoop:</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="number">3</span>; j++ &#123;</span><br><span class="line">            <span class="keyword">if</span> i*j &gt;= <span class="number">4</span> &#123;</span><br><span class="line">                <span class="keyword">break</span> outerLoop</span><br><span class="line">            &#125;</span><br><span class="line">            fmt.Printf(<span class="string">&quot;%d &quot;</span>, i*j)</span><br><span class="line">            <span class="comment">// 0 0 0</span></span><br><span class="line">            <span class="comment">// 0 1 2</span></span><br><span class="line">            <span class="comment">// 0 2</span></span><br><span class="line">        &#125;</span><br><span class="line">        fmt.Println()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>

<h2 id="continue"><a href="#continue" class="headerlink" title="continue"></a>continue</h2><ul>
<li>只用于 for 流程中</li>
<li>支持可选的 label 标识在哪个位置继续</li>
</ul>
<div class="tabs" id="cs-continue"><ul class="nav-tabs"><li class="tab active"><a href="#cs-continue-1">WithLabel</a></li></ul><div class="tab-content"><div class="tab-pane active" id="cs-continue-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    outerLoop:</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="number">3</span>; j++ &#123;</span><br><span class="line">            <span class="keyword">if</span> i*j &gt;= <span class="number">4</span> &#123;</span><br><span class="line">                <span class="keyword">continue</span> outerLoop</span><br><span class="line">            &#125;</span><br><span class="line">            fmt.Printf(<span class="string">&quot;%d &quot;</span>, i*j)</span><br><span class="line">            <span class="comment">// 0 0 0</span></span><br><span class="line">            <span class="comment">// 0 1 2</span></span><br><span class="line">            <span class="comment">// 0 2 0 3 0</span></span><br><span class="line">        &#125;</span><br><span class="line">        fmt.Println()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>

<h2 id="goto"><a href="#goto" class="headerlink" title="goto"></a>goto</h2><ul>
<li>goto 语句可以跳转到指定标签的位置，在某些情况下可以使代码更简洁高效</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    i := <span class="number">0</span></span><br><span class="line"></span><br><span class="line">start:</span><br><span class="line">    <span class="keyword">if</span> i &gt;= <span class="number">3</span> &#123;</span><br><span class="line">        <span class="keyword">goto</span> end</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(i)</span><br><span class="line">    i++</span><br><span class="line">    <span class="keyword">goto</span> start</span><br><span class="line"></span><br><span class="line">end:</span><br><span class="line">    fmt.Println(<span class="string">&quot;done&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*[OUTPUT]</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">done</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="go"><a href="#go" class="headerlink" title="go"></a>go</h2><ul>
<li>Go 语句（go statements）提供了一种创建和启动 goroutine 的方式，可以在单个程序中并发执行多个任务<ul>
<li>goroutine 执行函数的返回值可以通过通道（channel）来传递</li>
</ul>
</li>
</ul>
<div class="tabs" id="go-goroutine"><ul class="nav-tabs"><li class="tab active"><a href="#go-goroutine-1">Basic</a></li><li class="tab"><a href="#go-goroutine-2">ReturnByChannel</a></li></ul><div class="tab-content"><div class="tab-pane active" id="go-goroutine-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">task</span><span class="params">(name <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ &#123;</span><br><span class="line">        fmt.Println(name)</span><br><span class="line">        time.Sleep(time.Second)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">go</span> task(<span class="string">&quot;A&quot;</span>)</span><br><span class="line">    <span class="keyword">go</span> task(<span class="string">&quot;B&quot;</span>)</span><br><span class="line"></span><br><span class="line">    time.Sleep(time.Second * <span class="number">4</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;done&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*[OUTPUT]</span></span><br><span class="line"><span class="comment">B</span></span><br><span class="line"><span class="comment">A</span></span><br><span class="line"><span class="comment">A</span></span><br><span class="line"><span class="comment">B</span></span><br><span class="line"><span class="comment">B</span></span><br><span class="line"><span class="comment">A</span></span><br><span class="line"><span class="comment">done</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-goroutine-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">task</span><span class="params">(n <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    time.Sleep(time.Second)</span><br><span class="line">    <span class="keyword">return</span> n * <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        result := task(<span class="number">10</span>)</span><br><span class="line">        ch &lt;- result</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        result := task(<span class="number">20</span>)</span><br><span class="line">        ch &lt;- result</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    result1 := &lt;-ch</span><br><span class="line">    result2 := &lt;-ch</span><br><span class="line"></span><br><span class="line">    fmt.Println(result1, result2) <span class="comment">// 20 40</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>

<h3 id="goroutine"><a href="#goroutine" class="headerlink" title="goroutine"></a>goroutine</h3><ul>
<li>goroutine 模型：它是一个在同一地址空间中与其他 goroutine 并发（concurrent）执行的函数<ul>
<li>内存很轻量，起初只占用少量 stack 空间，后续按需分配或释放 heap 空间</li>
<li>goroutines 被多路复用（multiplexed）到多个 OS 线程（multi-threads）上</li>
<li>goroutine 概念严格来说不同于 thread、coroutine 和 process</li>
<li>goroutine 不可以从外部无条件地结束掉，只能通过 channel 来与它通信</li>
<li>程序初始时（<code>main()</code>）运行在一个 goroutine 上，后续可以创建新的 goroutine 以并发执行</li>
<li><code>go func()</code>语句会在一个新的 goroutine 中运行，且函数执行完成后，对应的 goroutine 也随之终止</li>
</ul>
</li>
<li>函数字面量（匿名函数）通常实现为闭包（closure）：确保 goroutine 执行时用到的外部变量仍然是 survive<ul>
<li>闭包（closure）是指一个函数与其引用的外部变量所组成的实体</li>
</ul>
</li>
<li>通道（channel）用于 goroutine 之间传递数据，以代替并发访问共享内存（shared memory）的编程方式</li>
</ul>
<div class="tabs" id="goroutine"><ul class="nav-tabs"><li class="tab active"><a href="#goroutine-1">Closure</a></li><li class="tab"><a href="#goroutine-2">HttpServer</a></li></ul><div class="tab-content"><div class="tab-pane active" id="goroutine-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// counter() is closure</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">counter</span><span class="params">()</span></span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    count := <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">        count++</span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    c1 := counter()</span><br><span class="line">    c2 := counter()</span><br><span class="line"></span><br><span class="line">    fmt.Println(c1()) <span class="comment">// 1</span></span><br><span class="line">    fmt.Println(c1()) <span class="comment">// 2</span></span><br><span class="line">    fmt.Println(c2()) <span class="comment">// 1</span></span><br><span class="line">    fmt.Println(c2()) <span class="comment">// 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="goroutine-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(ch <span class="keyword">chan</span> <span class="type">string</span>)</span></span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        ch &lt;- r.URL.Path</span><br><span class="line">        fmt.Fprintf(w, <span class="string">&quot;Path:%v Query:%v\n&quot;</span>, r.URL.Path, r.URL.RawQuery)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">for</span> &#123;</span><br><span class="line">            msg := &lt;-ch</span><br><span class="line">            fmt.Println(<span class="string">&quot;received request:&quot;</span>, msg)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    http.HandleFunc(<span class="string">&quot;/&quot;</span>, handler(ch))</span><br><span class="line">    http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*[OUTPUT]</span></span><br><span class="line"><span class="comment">$ curl &quot;http://localhost:8080/x/y/z?a=1&amp;b=2&amp;c=3&quot;</span></span><br><span class="line"><span class="comment">Path:/x/y/z Query:a=1&amp;b=2&amp;c=3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></div></div></div>

<h4 id="超时"><a href="#超时" class="headerlink" title="超时"></a>超时</h4><ul>
<li>利用 time.After 启动了一个异步的定时器（要避免永久阻塞在 channel 上）</li>
</ul>
<div class="tabs" id="goroutine-timeout"><ul class="nav-tabs"><li class="tab active"><a href="#goroutine-timeout-1">BadStyle</a></li><li class="tab"><a href="#goroutine-timeout-2">GoodStyle</a></li></ul><div class="tab-content"><div class="tab-pane active" id="goroutine-timeout-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> dep_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;runtime&quot;</span></span><br><span class="line">    <span class="string">&quot;testing&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doBad</span><span class="params">(done <span class="keyword">chan</span> <span class="type">bool</span>)</span></span> &#123;</span><br><span class="line">    time.Sleep(time.Second)</span><br><span class="line">    done &lt;- <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runBad</span><span class="params">(size <span class="type">int</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="comment">// BAD: unbufferd chan will block forever after timeout!</span></span><br><span class="line">    done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>, size)</span><br><span class="line">    <span class="keyword">go</span> doBad(done)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> &lt;-done:</span><br><span class="line">        fmt.Println(<span class="string">&quot;done&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">case</span> &lt;-time.After(time.Millisecond):</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;timeout&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testRun</span><span class="params">(t *testing.T, size <span class="type">int</span>, args ...any)</span></span> &#123;</span><br><span class="line">    t.Helper()</span><br><span class="line">    t.Log(<span class="string">&quot;S&gt;&quot;</span>, runtime.NumGoroutine())</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; size; i++ &#123;</span><br><span class="line">        <span class="keyword">switch</span> f := args[<span class="number">0</span>].(<span class="keyword">type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="type">error</span>:</span><br><span class="line">            f()</span><br><span class="line">        <span class="keyword">case</span> <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">int</span>)</span></span> <span class="type">error</span>:</span><br><span class="line">            f(args[<span class="number">1</span>].(<span class="type">int</span>))</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            fmt.Printf(<span class="string">&quot;%T&quot;</span>, size)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    time.Sleep(time.Second * <span class="number">3</span>)</span><br><span class="line">    t.Log(<span class="string">&quot;E&gt;&quot;</span>, runtime.NumGoroutine())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestTimeout1</span><span class="params">(t *testing.T)</span></span> &#123; testRun(t, <span class="number">1000</span>, runBad, <span class="number">0</span>) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestTimeout2</span><span class="params">(t *testing.T)</span></span> &#123; testRun(t, <span class="number">1000</span>, runBad, <span class="number">1</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">=== RUN   TestTimeout1</span></span><br><span class="line"><span class="comment">    routine_test.go:72: S&gt; 2</span></span><br><span class="line"><span class="comment">    routine_test.go:72: E&gt; 1002</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">=== RUN   TestTimeout2</span></span><br><span class="line"><span class="comment">    routine_test.go:73: S&gt; 2</span></span><br><span class="line"><span class="comment">    routine_test.go:73: E&gt; 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="goroutine-timeout-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> dep_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;runtime&quot;</span></span><br><span class="line">    <span class="string">&quot;testing&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doGood</span><span class="params">(waitDone, done <span class="keyword">chan</span> <span class="type">bool</span>)</span></span> &#123;</span><br><span class="line">    time.Sleep(time.Second)</span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> waitDone &lt;- <span class="literal">true</span>:</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    time.Sleep(time.Second)</span><br><span class="line">    done &lt;- <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runGood</span><span class="params">()</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    waitDone := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>)</span><br><span class="line">    done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>)</span><br><span class="line">    <span class="keyword">go</span> doGood(waitDone, done)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> &lt;-waitDone:</span><br><span class="line">        &lt;-done</span><br><span class="line">        fmt.Println(<span class="string">&quot;done&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">case</span> &lt;-time.After(time.Millisecond):</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;timeout&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testRun</span><span class="params">(t *testing.T, size <span class="type">int</span>, args ...any)</span></span> &#123;</span><br><span class="line">    t.Helper()</span><br><span class="line">    t.Log(<span class="string">&quot;S&gt;&quot;</span>, runtime.NumGoroutine())</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; size; i++ &#123;</span><br><span class="line">        <span class="keyword">switch</span> f := args[<span class="number">0</span>].(<span class="keyword">type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="type">error</span>:</span><br><span class="line">            f()</span><br><span class="line">        <span class="keyword">case</span> <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">int</span>)</span></span> <span class="type">error</span>:</span><br><span class="line">            f(args[<span class="number">1</span>].(<span class="type">int</span>))</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            fmt.Printf(<span class="string">&quot;%T&quot;</span>, size)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    time.Sleep(time.Second * <span class="number">3</span>)</span><br><span class="line">    t.Log(<span class="string">&quot;E&gt;&quot;</span>, runtime.NumGoroutine())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestTimeout3</span><span class="params">(t *testing.T)</span></span> &#123; testRun(t, <span class="number">1000</span>, runGood) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">=== RUN   TestTimeout3</span></span><br><span class="line"><span class="comment">    routine_test.go:74: S&gt; 2</span></span><br><span class="line"><span class="comment">    routine_test.go:74: E&gt; 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></div></div></div>

<h4 id="退出"><a href="#退出" class="headerlink" title="退出"></a>退出</h4><ul>
<li>一个 channel 有两个队列，分别存放发送和接收数据的 goroutine，这两个队列全为空时，通道才能被 GC 回收</li>
<li>一个 goroutine 处于任一通道的某个队列中时，此协程也不会被 GC 回收</li>
</ul>
<h4 id="并行性（Parallelization）"><a href="#并行性（Parallelization）" class="headerlink" title="并行性（Parallelization）"></a>并行性（Parallelization）</h4><ul>
<li>并行性（parallelization）指在多个 CPU 核心上进行运算<ul>
<li>如果一个问题可以分割成独立进行的多个片段（piece），就可以并行化处理它</li>
</ul>
</li>
<li>Go 是为并发性（concurrent）设计的语言，虽然也适合一部分并行任务，但并不是所有并行任务都适合用 Go 处理</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;runtime&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vector []<span class="type">float64</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Vector)</span></span> DoSome(i, n <span class="type">int</span>, u Vector, c <span class="keyword">chan</span> <span class="type">int</span>) &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ; i &lt; n &amp;&amp; i &lt; <span class="built_in">len</span>(v); i++ &#123;</span><br><span class="line">        v[i] = <span class="number">2</span> * u[i]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    time.Sleep(time.Duration(i%<span class="number">2</span>) * time.Second)</span><br><span class="line"></span><br><span class="line">    c &lt;- <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    v1 := Vector&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;</span><br><span class="line">    v2 := Vector&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;</span><br><span class="line"></span><br><span class="line">    numCPU := runtime.NumCPU()</span><br><span class="line">    c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, numCPU) <span class="comment">// (only used when need to receive return values)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// separate pieces (parallelize calc)</span></span><br><span class="line">    chunkSize := (<span class="built_in">len</span>(v1) + <span class="built_in">len</span>(v1)%numCPU) / numCPU</span><br><span class="line">    fmt.Printf(<span class="string">&quot;numCPU:%v chunkSize:%v\n&quot;</span>, numCPU, chunkSize) <span class="comment">// numCPU:4 chunkSize:3</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; numCPU; i++ &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> v1.DoSome(i*chunkSize, (i+<span class="number">1</span>)*chunkSize, v2, c)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// wait all goroutine finished</span></span><br><span class="line">    wg.Wait()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// receive all of return values (not need in this example)</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; numCPU; i++ &#123;</span><br><span class="line">        &lt;-c</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(v1) <span class="comment">// [0 2 4 6 8 10 12 14 16 18]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="泛型编程（generic-programming）"><a href="#泛型编程（generic-programming）" class="headerlink" title="泛型编程（generic programming）"></a>泛型编程（generic programming）</h1><h2 id="类型参数（Type-parameter）"><a href="#类型参数（Type-parameter）" class="headerlink" title="类型参数（Type parameter）"></a>类型参数（Type parameter）</h2><ul>
<li>类型参数声明（Type parameter declaration）是一种支持泛型编程的机制，可以在函数、结构体等类型中定义泛型类型</li>
</ul>
<div class="tabs" id="go-generic-programming"><ul class="nav-tabs"><li class="tab active"><a href="#go-generic-programming-1">UsedInStruct</a></li><li class="tab"><a href="#go-generic-programming-2">UsedInInterface</a></li><li class="tab"><a href="#go-generic-programming-3">UsedInFunction</a></li></ul><div class="tab-content"><div class="tab-pane active" id="go-generic-programming-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// [T any] is type parameter</span></span><br><span class="line"><span class="keyword">type</span> Node[T any] <span class="keyword">struct</span> &#123;</span><br><span class="line">    Value T</span><br><span class="line">    Next  *Node[T]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    iN := &amp;Node[<span class="type">int</span>]&#123;Value: <span class="number">1</span>&#125;</span><br><span class="line">    sN := &amp;Node[<span class="type">string</span>]&#123;Value: <span class="string">&quot;a&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    iN.Next = &amp;Node[<span class="type">int</span>]&#123;Value: <span class="number">2</span>&#125;</span><br><span class="line">    sN.Next = &amp;Node[<span class="type">string</span>]&#123;Value: <span class="string">&quot;b&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(iN.Value, iN.Next.Value) <span class="comment">// 1 2</span></span><br><span class="line">    fmt.Println(sN.Value, sN.Next.Value) <span class="comment">// a b</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-generic-programming-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Define generic interface</span></span><br><span class="line"><span class="keyword">type</span> Stack[T any] <span class="keyword">interface</span> &#123;</span><br><span class="line">    Push(value T)</span><br><span class="line">    Pop() T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IntStack <span class="keyword">struct</span> &#123;</span><br><span class="line">    values []<span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *IntStack)</span></span> Push(value <span class="type">int</span>) &#123;</span><br><span class="line">    s.values = <span class="built_in">append</span>(s.values, value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *IntStack)</span></span> Pop() <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(s.values) == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    value := s.values[<span class="built_in">len</span>(s.values)<span class="number">-1</span>]</span><br><span class="line">    s.values = s.values[:<span class="built_in">len</span>(s.values)<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> StringStack <span class="keyword">struct</span> &#123;</span><br><span class="line">    values []<span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *StringStack)</span></span> Push(value <span class="type">string</span>) &#123;</span><br><span class="line">    s.values = <span class="built_in">append</span>(s.values, value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *StringStack)</span></span> Pop() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(s.values) == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    value := s.values[<span class="built_in">len</span>(s.values)<span class="number">-1</span>]</span><br><span class="line">    s.values = s.values[:<span class="built_in">len</span>(s.values)<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    iS := &amp;IntStack&#123;&#125;</span><br><span class="line">    sS := &amp;StringStack&#123;&#125;</span><br><span class="line"></span><br><span class="line">    iS.Push(<span class="number">3</span>)</span><br><span class="line">    iS.Push(<span class="number">4</span>)</span><br><span class="line">    sS.Push(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">    sS.Push(<span class="string">&quot;b&quot;</span>)</span><br><span class="line"></span><br><span class="line">    fmt.Println(iS.Pop(), iS.Pop(), iS.Pop()) <span class="comment">// 4 3 0</span></span><br><span class="line">    fmt.Println(sS.Pop(), sS.Pop(), iS.Pop()) <span class="comment">// b a 0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-generic-programming-3"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Generic function</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Swap</span>[<span class="title">T1</span>, <span class="title">T2</span> <span class="title">any</span>]<span class="params">(a T1, b T2)</span></span> (T2, T1) &#123;</span><br><span class="line">    <span class="keyword">return</span> b, a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    x, y := Swap(<span class="number">1</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    fmt.Println(x, y) <span class="comment">// a 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>

<h2 id="类型约束（Type-constraint）"><a href="#类型约束（Type-constraint）" class="headerlink" title="类型约束（Type constraint）"></a>类型约束（Type constraint）</h2><ul>
<li>类型约束（Type constraint）是一种泛型编程的机制，用于限制泛型类型的范围，使得其只能是指定的类型或者其子类型</li>
</ul>
<div class="tabs" id="go-type-constraint"><ul class="nav-tabs"><li class="tab active"><a href="#go-type-constraint-1">Basic</a></li></ul><div class="tab-content"><div class="tab-pane active" id="go-type-constraint-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Animal <span class="keyword">interface</span> &#123;</span><br><span class="line">    Speak() <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Dog <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *Dog)</span></span> Speak() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;woof&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 限制泛型类型T为Animal接口的实现类型</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Speak</span>[<span class="title">T</span> <span class="title">Animal</span>]<span class="params">(a T)</span></span> &#123;</span><br><span class="line">    fmt.Println(a.Speak())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 限制结构体的字段类型T必须为Animal接口的实现类型</span></span><br><span class="line"><span class="keyword">type</span> Pet[T Animal] <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name   <span class="type">string</span></span><br><span class="line">    Animal T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    dog := &amp;Dog&#123;Name: <span class="string">&quot;A&quot;</span>&#125;</span><br><span class="line">    Speak(dog) <span class="comment">// woof</span></span><br><span class="line"></span><br><span class="line">    pet := &amp;Pet[Animal]&#123;Name: <span class="string">&quot;B&quot;</span>, Animal: dog&#125;</span><br><span class="line">    fmt.Println(pet.Name, pet.Animal.Speak()) <span class="comment">// B woof</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>

<h1 id="包（package）"><a href="#包（package）" class="headerlink" title="包（package）"></a>包（package）</h1><ul>
<li>一个包的所有实现通常要放在同一个目录下，其中的所有源文件具有相同的包名（PackageName）</li>
<li>每个源文件都要在顶部定义其属于的包，例如<code>package main</code></li>
<li>通过<code>import</code>来导入外部的标识符（identifier）<ul>
<li>导入路径通常是相对于包的安装路径的文件路径</li>
<li>当导入路径省略 PackageName 时，默认为当前文件所属的包</li>
<li>当导入路径有<code>.</code>前缀时，指所有的标识符都会导入过来，且无需通过前缀限定符进行访问（accessed）</li>
<li><strong>非法操作</strong>：<ul>
<li>当前文件直接或间接的导入自己是非法的</li>
<li>未使用导入包中的任何标识符是非法的</li>
<li>不允许产生循环依赖（cyclic dependencies）</li>
</ul>
</li>
</ul>
</li>
<li>包的初始化：<ul>
<li>源文件内可以实现<code>init() &#123; ... &#125;</code>函数（无参数且无返回值），在包中的变量初始化完毕后自动调用它<ul>
<li><code>init()</code>函数不能被外部引用</li>
<li>文件 p 顶部有<code>import q</code>时，q 的<code>init()</code>函数一定是先于 p 中的代码执行的</li>
<li>所有的<code>init()</code>函数都在<code>mian()</code>函数之前执行的</li>
</ul>
</li>
<li>包内的所有 package-level 的变量与<code>init()</code>函数在单个 goroutine 中执行，且<code>init()</code>函数内也可以启动其他 goroutine，这些 goroutine 是并发运行的，但是编译器会保证在前一项返回后才会继续下一项</li>
<li>包内的文件是按照文件名的词法顺序交给编译器的，以确保初始化行为是可复现的</li>
</ul>
</li>
<li>main 包：<ul>
<li>每个可执行程序都必须有一个非导入的 main 包，且其中要定义函数<code>func main() &#123; ... &#125;</code>（无函数且无返回值）</li>
<li><code>main()</code>函数返回后，程序即会退出，而且不会等待其他 non-main 的 goroutine 完成</li>
</ul>
</li>
</ul>
<div class="tabs" id="go-package"><ul class="nav-tabs"><li class="tab active"><a href="#go-package-1">import</a></li><li class="tab"><a href="#go-package-2">init()</a></li></ul><div class="tab-content"><div class="tab-pane active" id="go-package-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>   <span class="string">&quot;lib/math&quot;</span> <span class="comment">// math.Sin（无前缀，需要带限定符math访问Sin）</span></span><br><span class="line"><span class="keyword">import</span> m <span class="string">&quot;lib/math&quot;</span> <span class="comment">// m.Sin (前缀限定符别名，可以通过别名访问Sin)</span></span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;lib/math&quot;</span> <span class="comment">// Sin (前缀&#x27;.&#x27;表示无需提供限定符访问Sin)</span></span><br><span class="line"><span class="keyword">import</span> _ <span class="string">&quot;lib/math&quot;</span> <span class="comment">// (前缀&#x27;_&#x27;作为别名导入，表示只想执行此包下的init())</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-package-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> user == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        log.Fatal(<span class="string">&quot;$USER not set&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> home == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        home = <span class="string">&quot;/home/&quot;</span> + user</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> gopath == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        gopath = home + <span class="string">&quot;/go&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// gopath may be overridden by --gopath flag on command line.</span></span><br><span class="line">    flag.StringVar(&amp;gopath, <span class="string">&quot;gopath&quot;</span>, gopath, <span class="string">&quot;override default GOPATH&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>

<h1 id="模块（module）"><a href="#模块（module）" class="headerlink" title="模块（module）"></a>模块（module）</h1><ul>
<li>模块（module）在 go v1.11 版本支持，是一起发布的包（package）的集合，可以直接从版本控制仓库下载<ul>
<li>版本（version）可看成模块的快照，通常用来参与命名模块子目录的名字，例如<code>tools@v0.1.1</code><ul>
<li>对于向后不兼容的版本，主版本号（major）递增，次要（minor）版本和分支（patch）版本从 0 开始</li>
<li>对于向后兼容的版本，public 接口变化了，major 版本不变，minor 递增，patch 从 0 开始</li>
<li>对于 public 接口没有变化的版本，只递增 patch 版本</li>
<li><code>v1.2.3-pre</code>表示预发版本，其下一个版本应该为<code>v1.2.3</code></li>
</ul>
</li>
<li><code>GO111MODULE</code>环境变量控制 go 命令的运行模式<ul>
<li><code>GO111MODULE=on</code>表示在模块感知模式（module-aware mode，go v1.16 默认）</li>
<li><code>GO111MODULE=off</code>表示在 GOPATH 模式（GOPATH mode）</li>
</ul>
</li>
</ul>
</li>
<li><code>go.mod</code>文件放在模块根（root）目录，包含模块的依赖信息，采用 UTF-8 编码，设计为利于人阅读且机器可写的<ul>
<li><code>module golang.org/x/net</code> 定义模块路径（module path）<ul>
<li>模块定义在仓库根路径时，模块路径等于仓库根路径（repository root path）</li>
<li>模块未定义在仓库根路径时，模块路径是仓库根路径（repository root path）的某个子目录</li>
<li>如果模块发布更高版本，模块路径必须以版本结尾（例如后缀<code>/v2</code>），且可以不创建版本后缀名字的子目录</li>
</ul>
</li>
</ul>
</li>
<li><code>go.sum</code>文件通常在<code>go.mod</code>旁边，包含依赖模块的 hash 值<ul>
<li>go 命令下载模块到缓存（GOMODCACHE）中时，会计算其 hash 值，然后与主模块的<code>go.sum</code>进行校验</li>
</ul>
</li>
<li><code>go mod</code>命令：<ul>
<li><code>go mod init example.com/mymodule</code> 初始化模块并创建 go.mod 文件</li>
<li><code>go mod tidy</code> 整理模块依赖关系，移除未使用的依赖包</li>
<li><code>go mod download</code> 下载模块依赖包，用于前期离线安装</li>
<li><code>go mod vendor</code> 将依赖包复制到 vendor 目录下，用于离线安装</li>
<li><code>go mod verify</code> 验证已下载的依赖包的完整性和安全性</li>
<li><code>go mod graph</code> 打印模块依赖关系的有向无环图</li>
<li><code>go mod why github.com/gorilla/mux</code> 查找某个依赖包被引用的原因</li>
<li><code>go mod edit -require github.com/gorilla/mux@v1.8.0</code> 编辑 go.mod，新增依赖包</li>
<li><code>go mod replace github.com/gorilla/mux =&gt; ../mux</code> 编辑 go.mod，用本地路径或 URL 替代某个依赖包</li>
</ul>
</li>
</ul>
<div class="tabs" id="go-module"><ul class="nav-tabs"><li class="tab active"><a href="#go-module-1">go.mod</a></li><li class="tab"><a href="#go-module-2">go.sum</a></li></ul><div class="tab-content"><div class="tab-pane active" id="go-module-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">module example.com/mymodule</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="number">1.16</span></span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">    github.com/gorilla/mux v1<span class="number">.8</span><span class="number">.0</span></span><br><span class="line">    github.com/google/uuid v1<span class="number">.2</span><span class="number">.0</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">replace github.com/gorilla/mux =&gt; ../mux</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="go-module-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">github.com/gorilla/mux v1<span class="number">.8</span><span class="number">.0</span> h1:RfXUfC5V7eJZ5XMZx1pT9yGn1Z9z7tIVpw6HxL0wQwI=</span><br><span class="line">github.com/gorilla/mux v1<span class="number">.8</span><span class="number">.0</span>/<span class="keyword">go</span>.mod h1:<span class="number">6</span>Yp1pP1T8UaW+<span class="number">6</span>RJLyNnLd8eGqN5zFz2jwvzgQu7+mE=</span><br><span class="line">github.com/google/uuid v1<span class="number">.2</span><span class="number">.0</span> h1:<span class="number">5</span>P4W5LdYdG5PQ+<span class="number">4</span>Jk5VXUyXe9iVzS6d6C0PWp7fQv08=</span><br><span class="line">github.com/google/uuid v1<span class="number">.2</span><span class="number">.0</span>/<span class="keyword">go</span>.mod h1:<span class="number">8</span>ZkLX2W/YptI9ZJnWgKxI1Zn4mQ6q8GVV6wRj1L4zB4=</span><br></pre></td></tr></table></figure></div></div></div>

<h1 id="工作空间（workspace）"><a href="#工作空间（workspace）" class="headerlink" title="工作空间（workspace）"></a>工作空间（workspace）</h1><ul>
<li>工作空间（workspace）在 go v1.17 版本支持，是磁盘上模块（module）的集合</li>
<li><code>GOWORK</code>环境变量控制是否启用工作空间<ul>
<li>未定义或空值时，会从当前工作目录开始向上搜索<code>go.work</code>文件<ul>
<li>找到<code>go.work</code>后，工作空间为此文件中定义的 module 路径</li>
<li>未找到<code>go.work</code>时，工作空间为当前工作目录下的 modules</li>
</ul>
</li>
<li>有定义时，工作空间为环境变量中定义的 module 路径</li>
</ul>
</li>
<li><code>go.work</code>定义工作空间中各个模块的相对路径</li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>[1] <a target="_blank" rel="noopener" href="https://go.dev/ref/spec">The Go Programming Language Specification</a><br>[2] <a target="_blank" rel="noopener" href="https://go.dev/doc/effective_go">Effective Go</a><br>[3] <a target="_blank" rel="noopener" href="https://github.com/geektutu/high-performance-go">high performance coding with golang</a><br>[4] <a target="_blank" rel="noopener" href="https://gfw.go101.org/">Go语言101</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Go/" rel="tag"><i class="fa fa-tag"></i> Go</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/ProgrammingLanguage/TypeScript/Basic.html" rel="prev" title="TypeScript基础">
                  <i class="fa fa-chevron-left"></i> TypeScript基础
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/ProgrammingLanguage/Go/StandardLibrary.html" rel="next" title="Go标准库">
                  Go标准库 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2020 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-burn"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ssyang</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Symbols count total">492k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">7:27</span>
  </span>
</div>
  <div class="powered-by"><a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a>/<a href="https://theme-next.js.org/mist/" class="theme-link" rel="noopener" target="_blank">NexT</a>
  </div>

    </div>
  </footer>

  
  <script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="/lib/jquery/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="/lib/@fancyapps/fancybox/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="/lib/pangu/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  
<script src="/lib/hexo-generator-searchdb/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-ph3Dk89VmuTVXG6x/RDzk53SU9LPdAh1tpv0UvnDZ2I="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-CmZCFVnvol9YL23PfjDflGY5nJwE+Mf/JN+8v+tD/34="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>

  <script src="/js/third-party/fancybox.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"/lib/mathjax/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


  <script src="/lib/quicklink/dist/quicklink.umd.js" integrity="sha256-4kQf9z5ntdQrzsBC3YSHnEz02Z9C1UeW/E9OgnvlzSY=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://blog.imssyang.com/ProgrammingLanguage/Go/Basic.html"}</script>
  <script src="/js/third-party/quicklink.js"></script>
<link rel="stylesheet" href="/lib/disqusjs/dist/disqusjs.css" integrity="sha256-GxdCIOyfxQ1OBfS99qAIJDoGK1ADuBsxhMTqXG82fAY=" crossorigin="anonymous">

<script class="next-config" data-name="disqusjs" type="application/json">{"enable":true,"api":"https://disqus.com/api/","apikey":"9zaN2jW6zXMHxC3NctLnrVsVuNe4yZ8CyZ1rWAJQKcIc7JMaHNPP9m4vra2AJeIA","shortname":"imssyang","js":{"url":"/lib/disqusjs/dist/disqus.js","integrity":"sha256-LVaMHPQ2zLqOc5rXSAfr4d1PIkEGNLyyUTDNPZmTtUw="}}</script>
<script src="/js/third-party/comments/disqusjs.js"></script>

</body>
</html>
